/*! senate-timesheets - v - 2016-09-02 */function locationService(a,b,c,d){function e(b,c,d,e){var f=a.search(b,d!==!1?c:null);e!==!1&&f.replace()}function f(b){return a.search()[b]}function g(){a.search({})}function h(b){a.hash(b),c()}function i(c,e,f){a.path(d.ctxPath+c).search(f?f:{}),e===!0&&b.location.reload()}return{setSearchParam:e,getSearchParam:f,clearSearchParams:g,scrollToId:h,go:i}}function promiseUtilsService(a){function b(b){var c=a.when();return angular.forEach(b,function(a){c=c?c.then(a):a()}),c}return{serial:b}}function zeroPadFilter(){return zeroPad}function zeroPad(a,b){var c=""+a;return c.length>b?c:(Math.pow(10,b)+""+c).slice(-b)}function accrualHistoryCtrl(a,b,c,d,e,f,g,h){function i(){a.state.empId&&f.get({empId:a.state.empId,detail:!0},function(b){var c=b.employee;a.state.empInfo=c,a.state.isTe="TE"===c.payType},function(a){g.open("500",a)})}a.state={empId:c.user.employeeId,today:moment(),accSummaries:{},activeYears:[],selectedYear:null,empInfo:{},isTe:!1,searching:!1,error:null},a.floatTheadOpts={scrollingTop:47,useAbsolutePositioning:!1},a.$watch("state.empId",i),a.getAccSummaries=function(b){if(a.state.accSummaries[b])return a.state.accSummaries[b];a.state.searching=!0;var c=moment([b,0,1]),e=moment([b+1,0,1]).subtract(1,"days");d.get({empId:a.state.empId,fromDate:c.format("YYYY-MM-DD"),toDate:e.format("YYYY-MM-DD")},function(c){c.success&&(a.state.error=null,h.computeDeltas(c.result),a.state.accSummaries[b]=c.result.filter(function(a){return!a.computed}).reverse()),a.state.searching=!1},function(b){g.open("500",{details:b}),a.state.error={title:"Could not retrieve accrual information.",message:"If you are eligible for accruals please try again later."}})},a.getEmpActiveYears=function(b){e.get({empId:a.state.empId},function(c){a.state.activeYears=c.activeYears.reverse(),a.state.selectedYear=c.activeYears[0],b&&b()},function(a){g.open("500",{details:a})})},a.getaccSummaries=function(){return b(function(){$("table").floatThead("reflow")},0),a.state.accSummaries[a.state.selectedYear]},a.init=function(){a.getEmpActiveYears(function(){a.getAccSummaries(a.state.selectedYear)})}()}function accrualProjectionCtrl(a,b,c,d,e,f,g){function h(a){return a.computed&&"TE"!==a.empState.payType&&a.empState.employeeActive}function i(a){return k.forEach(function(b){0===a[b]&&(a[b]=null)}),a}function j(){a.state.empId&&e.get({empId:a.state.empId,detail:!0},function(b){var c=b.employee;a.state.empInfo=c,a.state.isTe="TE"===c.payType},function(a){f.open("500",a)})}a.state={empId:c.user.employeeId,today:moment(),projections:{},accSummaries:{},selectedYear:moment().year(),empInfo:{},isTe:!1,searching:!1,error:null},a.floatTheadOpts={scrollingTop:47,useAbsolutePositioning:!1},a.$watch("state.empId",j),a.init=function(){a.getAccSummaries(a.state.selectedYear)},a.getAccSummaries=function(b){a.state.searching=!0;var c=moment([b,0,1]),e=moment([b+1,0,1]).subtract(1,"days");d.get({empId:a.state.empId,fromDate:c.format("YYYY-MM-DD"),toDate:e.format("YYYY-MM-DD")},function(c){c.success&&(a.state.error=null,g.computeDeltas(c.result),a.state.accSummaries[b]=c.result.filter(function(a){return!a.computed}).reverse(),b>=a.state.today.year()-1&&(a.state.projections[b]=c.result.filter(h).map(i))),a.state.searching=!1},function(b){f.open("500",{details:b}),a.state.error={title:"Could not retrieve accrual information.",message:"If you are eligible for accruals please try again later."}})},a.recalculateProjectionTotals=function(b){var c=(a.state.projections[b].length,a.state.accSummaries[b].length),d=null;d=c>0?a.state.accSummaries[b][0]:a.state.projections[b][0];for(var e=d.personalUsed,f=d.vacationUsed,g=d.empSickUsed+d.famSickUsed,h=0;h<a.state.projections[b].length;h++){var i=a.state.projections[b][h];e+=i.personalUsedDelta||0,f+=i.vacationUsedDelta||0,g+=i.sickUsedDelta||0,i.personalAvailable=i.personalAccruedYtd-e,i.vacationAvailable=i.vacationAccruedYtd+i.vacationBanked-f,i.sickAvailable=i.sickAccruedYtd+i.sickBanked-g}};var k=["personalUsedDelta","vacationUsedDelta","sickUsedDelta"];a.getProjection=function(){return b(function(){$("table").floatThead("reflow")},0),a.state.projections[a.state.selectedYear]},a.init()}function accrualUtils(){function a(a){for(var b=0;b<a.length;b++){var c=a[b];if(0==b)c.vacationUsedDelta=c.vacationUsed,c.personalUsedDelta=c.personalUsed,c.sickUsedDelta=c.empSickUsed+c.famSickUsed;else{var d=a[b-1];c.vacationUsedDelta=c.vacationUsed-d.vacationUsed,c.personalUsedDelta=c.personalUsed-d.personalUsed,c.sickUsedDelta=c.empSickUsed+c.famSickUsed-(d.empSickUsed+d.famSickUsed)}}}return{computeDeltas:a}}function empRecordHistoryCtrl(a,b,c,d,e,f,g,h,i){function j(a){a.supStartMoment=moment(a.supStartDate||"1970-01-01"),a.supEndMoment=moment(a.supEndDate||void 0),a.dropDownLabel=a.empLastName+" ("+a.supStartMoment.format("MMM YYYY")+" - "+a.supEndMoment.format("MMM YYYY")+")"}function k(){angular.forEach(a.state.timesheetRecords,function(b){i.calculateDailyTotals(b),b.totals=i.getRecordTotals(b),a.state.records.push(b)})}function l(){a.state.paperTimesheetsDisplayed=!1,a.state.attendRecords.filter(m).map(i.formatAttendRecord).forEach(function(b){a.state.paperTimesheetsDisplayed=!0,a.state.records.push(b)})}function m(b){if(!b.paperTimesheet)return!1;var c=a.state.timesheetRecords;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];if(b.beginDate===e.beginDate&&b.endDate===e.endDate)return!1}return!0}a.state={supId:c.user.employeeId,searching:!1,todayMoment:moment(),selectedEmp:null,recordYears:[],selectedRecYear:null,supStartDate:null,supEndDate:null,records:[],timesheetRecords:[],attendRecords:[],allEmps:[],primaryEmps:[]},a.getEmployeeGroups=function(b,c,d){var e=c?moment(c):moment().subtract(2,"years"),f=d?moment(d):moment();a.state.searching=!0,g.get({supId:b,fromDate:e.format("YYYY-MM-DD"),toDate:f.format("YYYY-MM-DD")},function(b){if(1==b.success){a.state.primaryEmps=b.result.primaryEmployees.sort(function(a,b){return a.empLastName.localeCompare(b.empLastName)});var c={};angular.forEach(a.state.primaryEmps,function(b){b.group="Direct employees",c[b.empId]=b.empLastName,j(b),a.state.allEmps.push(b)}),angular.forEach(b.result.empOverrideEmployees,function(b){b.group="Additional Employees",j(b),a.state.allEmps.push(b)}),angular.forEach(b.result.supOverrideEmployees.items,function(b,d){angular.forEach(b,function(b){b.group=c[d]?c[d]+"'s Employees":"Sup Override Employees",j(b),a.state.allEmps.push(b)})}),a.state.selectedEmp=a.state.allEmps[0],a.getTimeRecordsForEmp(a.state.selectedEmp)}a.state.searching=!1},function(b){a.state.searching=!1,h.open("500",{details:b})})},a.getTimeRecordsForEmp=function(b){d.get({empId:b.empId},function(c){if(c.success){var d=b.supStartMoment.year(),e=b.supEndMoment.year();a.state.recordYears=c.years.filter(function(a){return a>=d&&e>=a}).reverse(),a.state.selectedRecYear=a.state.recordYears[0],c.years.length>0&&a.getRecordsForYear(b,a.state.selectedRecYear)}},function(a){h.open("500",{details:a})})},a.getRecordsForYear=function(c,d){a.state.records=[],a.state.attendRecords=[],a.state.timesheetRecords=[];var e=moment([d,0,1]),f=a.state.todayMoment.year()==d?moment():moment([d,11,31]);return e.isAfter(c.supEndMoment)||f.isBefore(c.supStartMoment)?void(a.state.records=[]):(a.state.supStartDate=moment.max(e,c.supStartMoment),a.state.supEndDate=moment.min(f,c.supEndMoment),a.state.searching=!0,void b.all([a.getTimesheetRecords(),a.getAttendRecords()]).then(function(){k(),l(),a.state.records.sort(i.compareRecords).reverse()})["finally"](function(){a.state.searching=!1}))},a.getTimesheetRecords=function(){var b=a.state.selectedEmp;return e.get({empId:b.empId,from:a.state.supStartDate.format("YYYY-MM-DD"),to:a.state.supEndDate.format("YYYY-MM-DD")},function(c){a.state.timesheetRecords=(c.result.items[b.empId]||[]).reverse()},function(a){h.open("500",{details:a})}).$promise},a.getAttendRecords=function(b,c){var d={empId:a.state.selectedEmp.empId,from:a.state.supStartDate.format("YYYY-MM-DD"),to:a.state.supEndDate.format("YYYY-MM-DD")};return f.get(d,function(b){a.state.attendRecords=b.records},function(a){h.open("500",{details:a})}).$promise},a.showDetails=function(a){if(!a.paperTimesheet){var b={record:a};h.open("details",b,!0)}},a.init=function(){a.getEmployeeGroups(a.state.supId)}()}function recordEntryCtrl(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){return{empId:f.user.employeeId,miscLeaves:f.miscLeaves,miscLeaveGrants:null,accrual:null,allowances:{},selectedYear:0,records:[],iSelectedRecord:0,salaryRecs:[],iSelSalRec:0,tempEntries:!1,annualEntries:!1,totals:{},holidays:null,request:{records:!1,accruals:!1,allowances:!1,save:!1}}}function s(b,c){return function(d){return null!=d[b]&&a.getSelectedRecord().dirty?1:d.total<7&&!a.isWeekend(d.date)?1:c}}function t(){var b=a.state.records[a.state.iSelectedRecord];n.calculateDailyTotals(b),a.state.totals=n.getRecordTotals(b)}function u(){if(a.state.tempEntries=a.state.annualEntries=!1,a.state.records.length>0){var b=a.getSelectedRecord();for(var c in b.timeEntries){var d=b.timeEntries[c];z(d)?a.state.tempEntries=!0:A(d)&&(a.state.annualEntries=!0)}}}function v(){var b=[];if(a.state.salaryRecs=b,a.state.iSelSalRec=0,a.state.tempEntries){var d=a.state.allowances[a.state.selectedYear],e=a.getSelectedRecord(),f=0;angular.forEach(d.salaryRecs,function(c){"TE"!==c.payType||moment(c.effectDate).isAfter(e.endDate)||moment(e.beginDate).isAfter(c.endDate)||(b.push(c),c.salaryRate>f&&(f=c.salaryRate,a.state.iSelSalRec=d.salaryRecs.indexOf(c)))}),d.remainingAllowance=d.yearlyAllowance-d.moneyUsed,d.remainingHours=d.remainingAllowance/f,d.remainingHours=c("round")(d.remainingHours,.25,-1),d.totalHours=d.hoursUsed+d.remainingHours}}function w(a){if("boolean"==typeof a)return a;for(var b in a)if(a.hasOwnProperty(b)&&w(a[b]))return!1;return!0}function x(){var b=a.state.records[a.state.iSelectedRecord];o.setSearchParam("record",b.beginDate)}function y(){var b=o.getSearchParam("record");if(b)for(var c in a.state.records){var d=a.state.records[c];if(d.beginDate===b){a.state.iSelectedRecord=parseInt(c);break}}}function z(a){return"TE"===a.payType}function A(a){return"RA"===a.payType||"SA"===a.payType}function B(){var b=[];return a.expectedHoursEntered()||b.push(function(){return p.open("expectedhrs-dialog",!0)}),a.futureEndDate()&&b.push(function(){return p.open("futureenddt-dialog",!0)}),b}function C(){a.preValidation();var b=a.getSelectedRecord(),c=!0;return b&&b.timeEntries&&angular.forEach(b.timeEntries,function(a){c&=D(a)}),c}function D(b){var c=A(b)?"raSa":"te",d=!0;return angular.forEach(a.entryValidators[c],function(a){d&=a(b)}),d}function E(b){for(var c in a.state.records){var d=a.state.records[c];if(moment(d.beginDate).isBefore(b.beginDate))for(var e in d.timeEntries)if(A(d.timeEntries[e]))return void(a.errorTypes.record.prevUnsubmittedRecord=!0)}}function F(){var b=a.state.totals.sickEmpHours+a.state.totals.sickFamHours;return a.state.accrual&&b>a.state.accrual.sickAvailable?(a.errorTypes.raSa.notEnoughSickTime=!0,!1):!0}function G(b){return isNaN(b)||b%1%.5===0?!0:(a.errorTypes.raSa.halfHourIncrements=!0,!1)}function H(b){return isNaN(b)||b%1%.25===0?!0:(a.errorTypes.te.fifteenMinIncrements=!0,!1)}a.state=null,a.initializeState=function(){a.state=r()},a.init=function(){a.initializeState(),a.getRecords(),a.getMiscLeaveTypeGrants(),a.getHolidays()},a.$watchGroup(["state.records","state.iSelectedRecord"],function(){a.state.records&&a.state.records[a.state.iSelectedRecord]&&(u(),d.all([a.getAccrualForSelectedRecord(),a.getAllowanceForSelRecord()]).then(function(){v(),t(),x(),C()}))}),a.getRecords=function(){a.initializeState(),a.state.request.records=!0,g.get({empId:a.state.empId,scope:"E"},function(b){a.state.empId in b.result.items&&(a.state.records=b.result.items[a.state.empId],angular.forEach(a.state.records,function(a,b){var c=moment(a.endDate).add(1,"days").startOf("day");a.dueFromNowStr=c.fromNow(!1),a.isDue=c.isBefore(moment()),a.index=b,angular.forEach(a.timeEntries,function(a,b){a.index=b}),a.initialRemarks=a.remarks}),y())},function(a){p.open("500",{action:"get active records",details:a})}).$promise["finally"](function(){a.state.request.records=!1})},a.saveRecord=function(b){var c=a.state.records[a.state.iSelectedRecord];C();var d=a.selRecordHasEntryErrors();if(d||b&&a.selRecordHasRecordErrors())a.$broadcast("validateRecordEntries");else if(b){var e=B();q.serial(e).then(function(){return p.open("submit-ack",{record:c},!0)}).then(a.submitRecord).then(function(){return p.open("post-save",{},!0)}).then(a.logout,a.init)}else p.open("save-indicator",{record:c}).then(a.init),a.state.request.save=!0,h.save({action:"save"},c,function(a){c.updateDate=moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),c.savedDate=c.updateDate,c.dirty=!1},function(a){p.reject(),p.open("500",{details:a})}).$promise["finally"](function(){a.state.request.save=!1})},a.submitRecord=function(){var b=a.state.records[a.state.iSelectedRecord];return p.open("submit-progress"),h.save({action:"submit"},b,function(a){p.resolve()},function(a){p.reject(),p.open("500",{details:a})}).$promise["finally"](function(){a.state.request.save=!1})},a.getAccrualForSelectedRecord=function(){if(a.state.annualEntries){var b=a.state.empId,c=a.state.records[a.state.iSelectedRecord],e=moment(c.payPeriod.startDate);return a.state.request.accruals=!0,i.get({empId:b,beforeDate:e.format("YYYY-MM-DD")},function(b){b.success&&(a.state.accrual=b.result)},function(a){p.open("500",{details:a})}).$promise["finally"](function(){a.state.request.accruals=!1})}return d(function(a){a()})},a.getAllowanceForSelRecord=function(){var b=a.getSelectedRecord();if(a.state.selectedYear=moment(b.beginDate).year(),a.state.tempEntries&&!a.state.allowances.hasOwnProperty(a.state.selectedYear)){var c={empId:a.state.empId,year:a.state.selectedYear};return a.state.request.allowances=!0,j.get(c,function(b){for(var c in b.result){var d=b.result[c];a.state.allowances[d.year]=d}},function(a){p.open("500",{details:a})}).$promise["finally"](function(){a.state.request.allowances=!1})}return d(function(a){a()})},a.getMiscLeaveTypeGrants=function(){var b={empId:a.state.empId};k.get(b,function(b){a.state.miscLeaveGrants=b.result},function(a){p.open("500",{details:a})})},a.getHolidays=function(){var b={fromDate:moment().subtract(1,"year").format("YYYY-MM-DD"),toDate:moment().add(1,"year").format("YYYY-MM-DD")};l.get(b,function(b){a.state.holidays={},angular.forEach(b.holidays,function(b){b.unofficial||(a.state.holidays[b.date]=b)})},function(a){p.open("500",{details:a})})},a.getSelectedRecord=function(){return a.state.records[a.state.iSelectedRecord]},a.resolveModal=function(a){p.resolve(a)},a.rejectModal=function(a){p.reject(a)},a.isWeekend=function(a){return c("momentIsDOW")(a,[0,6])},a.setDirty=function(b){a.state.records[a.state.iSelectedRecord].dirty=!0,b&&(b.dirty=!0),t()},a.recordValid=function(){var b=a.getSelectedRecord();return!(null==b||a.selRecordHasEntryErrors())},a.recordSubmittable=function(){var b=a.getSelectedRecord();return a.recordValid()&&!a.selRecordHasRecordErrors()&&!moment(b.beginDate).isAfter(moment(),"day")},a.getAvailableHours=function(){var b=a.state.allowances[a.state.selectedYear],c=a.state.totals.tempWorkHours;return b&&!isNaN(c)?b.remainingHours-c:void 0},a.getSalRecDateRange=function(b){var c=a.getSelectedRecord(),d=moment(b.effectDate).isAfter(c.beginDate)?b.effectDate:c.beginDate,e=moment(b.endDate).isAfter(c.endDate)?c.endDate:b.endDate;return moment(d).format("M/D")+" - "+moment(e).format("M/D")},a.getSalRecStartDate=function(b){var c=a.getSelectedRecord();return moment(b.effectDate).isAfter(c.beginDate)?b.effectDate:c.beginDate},a.getSalRecEndDate=function(b){var c=a.getSelectedRecord();return moment(b.endDate).isAfter(c.endDate)?c.endDate:b.endDate},a.getRecordRangeDisplay=function(a){return moment(a.beginDate).format("l")+" - "+moment(a.endDate).format("l")},a.accrualTabIndex={vacation:s("vacationHours",2),personal:s("personalHours",2),sickEmp:s("sickEmpHours",2),sickFam:s("sickFamHours",2),misc:s("miscHours",2)},a.expectedHoursEntered=function(){return a.state.annualEntries?a.state.accrual.biWeekHrsExpected<=a.state.totals.raSaTotal:!0},a.futureEndDate=function(){var b=a.getSelectedRecord();return moment(b.endDate).isAfter(moment(),"day")?!0:void 0},a.getMiscLeavePredicate=function(b){var c=moment(b);return function(b){if(b.restricted===!1)return!0;for(var d in a.state.miscLeaveGrants){var e=a.state.miscLeaveGrants[d];if(!c.isBefore(e.beginDate,"day")&&!c.isAfter(e.endDate,"day")&&b.type===e.miscLeaveType)return!0}return!1}},a.isHoliday=function(b){return a.state.holidays&&a.state.holidays.hasOwnProperty(b.date)},a.getHolidayHours=function(b){return a.state.holidays?a.isHoliday(b)?a.state.holidays[b.date].hours:0:7},a.preValidation=function(){var b=a.getSelectedRecord();a.errorTypes.reset(),E(b)},a.errorTypes={raSa:{workHoursInvalidRange:!1,holidayHoursInvalidRange:!1,vacationHoursInvalidRange:!1,personalHoursInvalidRange:!1,empSickHoursInvalidRange:!1,famSickHoursInvalidRange:!1,miscHoursInvalidRange:!1,totalHoursInvalidRange:!1,notEnoughVacationTime:!1,notEnoughPersonalTime:!1,notEnoughSickTime:!1,noMiscTypeGiven:!1,noMiscHoursGiven:!1,halfHourIncrements:!1},te:{workHoursInvalidRange:!1,notEnoughWorkHours:!1,noComment:!1,noWorkHoursForComment:!1,fifteenMinIncrements:!1},record:{prevUnsubmittedRecord:!1},reset:function(a){void 0===a&&(a=this);var b=this;angular.forEach(a,function(c,d){"boolean"==typeof c?a[d]=!1:"object"==typeof c&&b.reset(c)})}},a.selRecordHasEntryErrors=function(){return a.selRecordHasRaSaErrors()||a.selRecordHasTeErrors()},a.selRecordHasRaSaErrors=function(){return!w(a.errorTypes.raSa)},a.selRecordHasTeErrors=function(){return!w(a.errorTypes.te)},a.selRecordHasRecordErrors=function(){return!w(a.errorTypes.record)},a.entryValidators={raSa:{workHours:function(b){var c=b.workHours;if(0===c||null===c)return!0;var d=!0;return"undefined"==typeof c&&(a.errorTypes.raSa.workHoursInvalidRange=!0,d=!1),d&=G(c)},holidayHours:function(b){if("SA"!==b.payType||!a.state.holidays||!a.isHoliday(b))return!0;var c=b.holidayHours,d=!0;return 0===c||null===c?!0:("undefined"==typeof c&&(a.errorTypes.raSa.holidayHoursInvalidRange=!0,d=!1),d&=G(c))},vacationHours:function(b){var c=b.vacationHours,d=!0;return 0===c||null===c?!0:(a.state.accrual&&a.state.totals.vacationHours>a.state.accrual.vacationAvailable&&(a.errorTypes.raSa.notEnoughVacationTime=!0,d=!1),"undefined"==typeof c&&(a.errorTypes.raSa.vacationHoursInvalidRange=!0,d=!1),d&=G(c))},personalHours:function(b){var c=b.personalHours,d=!0;return 0===c||null===c?!0:(a.state.accrual&&a.state.totals.personalHours>a.state.accrual.personalAvailable&&(a.errorTypes.raSa.notEnoughPersonalTime=!0,d=!1),"undefined"==typeof c&&(a.errorTypes.raSa.personalHoursInvalidRange=!0,d=!1),d&=G(c))},sickEmpHours:function(b){var c=b.sickEmpHours,d=!0;return 0===c||null===c?!0:(d&=F(),"undefined"==typeof c&&(a.errorTypes.raSa.empSickHoursInvalidRange=!0,d=!1),d&=G(c))},sickFamHours:function(b){var c=b.sickFamHours,d=!0;return 0===c||null===c?!0:(d&=F(),"undefined"==typeof c&&(a.errorTypes.raSa.famSickHoursInvalidRange=!0,d=!1),d&=G(c))},miscHours:function(b){var c=b.miscHours,d=!0;return 0===c||null===c?!0:("undefined"==typeof c&&(a.errorTypes.raSa.miscHoursInvalidRange=!0,d=!1),d&=G(c))},miscType:function(b){var c=null!==b.miscType,d=b.miscHours>0,e=b.index===m.getActiveRow();return e||c||!d?c&&!d?(a.errorTypes.raSa.noMiscHoursGiven=!0,!1):!0:(a.errorTypes.raSa.noMiscTypeGiven=!0,!1)},totalHours:function(b){return isNaN(b.total)||b.total>=0&&b.total<=24?!0:(a.errorTypes.raSa.totalHoursInvalidRange=!0,!1)}},te:{workHours:function(b){var c=b.workHours;if(0===c||null===c)return!0;var d=!0;return"undefined"==typeof c&&(a.errorTypes.te.workHoursInvalidRange=!0,d=!1),d&=H(c)},comment:function(b){var c=b.workHours,d=b.empComment,e=b.index===m.getActiveRow();return c>0&&!d&&!e?(a.errorTypes.te.noComment=!0,!1):null===c&&d?(a.errorTypes.te.noWorkHoursForComment=!0,!1):!0}}},a.init()}function recordHistoryCtrl(a,b,c,d,e,f,g,h){function i(){var b=a.state.timesheetRecords;for(var c in b){var d=b[c];h.calculateDailyTotals(d),d.totals=h.getRecordTotals(d),"E"===d.scope?a.records.employee.push(d):(l(d),a.records.other.unshift(d))}}function j(){var b=a.state.attendRecords,c=a.records.other;a.state.paperTimesheetsDisplayed=!1,b.map(h.formatAttendRecord).filter(k).forEach(function(b){l(b),c.unshift(b),a.state.paperTimesheetsDisplayed=!0})}function k(b){if(!b.paperTimesheet)return!1;var c=a.state.timesheetRecords;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];if(b.beginDate===e.beginDate&&b.endDate===e.endDate)return!1}return!0}function l(b){for(var c in b.totals)b.totals.hasOwnProperty(c)&&(a.annualTotals.hasOwnProperty(c)||(a.annualTotals[c]=0),a.annualTotals[c]+=b.totals[c])}a.state={searching:!1,recordYears:null,year:null,timeRecords:[],attendRecords:[]},a.init=function(){var b=c.user.employeeId;d.get({empId:b},function(b){a.state.recordYears=b.years.reverse(),a.state.year=a.state.recordYears[0],a.getRecords()},function(a){g.open("500",{action:"Get time record history",details:a})})},a.floatTheadOpts={scrollingTop:47},a.getRecords=function(){a.state.searching=!0,a.records={employee:[],other:[]},a.annualTotals={},b.all([a.getTimeRecords(),a.getAttendRecords()]).then(function(){})["catch"](function(a){})["finally"](function(){a.state.searching=!1,i(),j(),a.records.other.sort(h.compareRecords).reverse()})},a.getTimeRecords=function(){var b=c.user.employeeId,d=moment(),f={empId:b,from:a.state.year.toString()+"-01-01",to:a.state.year<d.year()?a.state.year.toString()+"-12-31":d.format("YYYY-MM-DD")};return e.get(f,function(c){a.state.timesheetRecords=c.result.items[b]},function(a){g.open("500",{details:a})}).$promise},a.getAttendRecords=function(){var b={empId:c.user.employeeId,year:a.state.year};return f.get(b,function(b){a.state.attendRecords=b.records},function(a){g.open("500",{details:a})}).$promise},a.showDetails=function(a){if(!a.paperTimesheet){var b={record:a};g.open("record-details",b,!0)}},a.init()}function recordManageCtrl(a,b,c,d,e,f,g,h,i){function j(){a.state.selSupId=s,a.state.supIds=[s],a.state.empInfos={},a.state.supRecords={}}function k(){a.state.loading=!0,j();var b=moment().subtract(1,"year").format("YYYY-MM-DD"),d=moment().format("YYYY-MM-DD"),f=c.user.employeeId;g.get({supId:f,from:b,to:d},function(b){o(b.result.items),l(),r(),a.state.loading=!1},function(b){a.state.loading=!1,e.open("500",{details:b})})}function l(){var b=a.state.supRecords[s].SUBMITTED?a.state.supRecords[s].SUBMITTED.length:0;f.setBadgeValue("pendingRecordCount",b)}function m(c){var d=[];return c.forEach(function(a){d.push(h.save({action:a.action},a,function(a){},function(a){return a}).$promise)}),a.state.loading=!0,b.all(d).then(function(){k()},function(b){a.state.loading=!1,e.open("500",{details:b})})}function n(a){if(!a)return b.when();var c=[],d=[];return a.forEach(function(a){c.push(a.employeeId),d.push(a.beginDate)}),e.open("record-reminder-posting"),i.save({empId:c,beginDate:d},{},function(){},function(a){e.rejectAll(),e.open("500",a)}).$promise["finally"](e.resolve)}function o(b){var c=a.state.supRecords[s]={};angular.forEach(b,function(b,e){angular.forEach(b,function(b){d.calculateDailyTotals(b),b.totals=d.getRecordTotals(b);var e=b.supervisorId,f=a.state.supIds;-1==f.indexOf(e)&&(a.state.supIds.push(e),a.state.empInfos[e]=b.supervisor);var g=a.state.supRecords[e]=a.state.supRecords[e]||{},h=g[b.recordStatus]=g[b.recordStatus]||[],i=c[b.recordStatus]=c[b.recordStatus]||[];h.push(b),i.push(b)})})}function p(b){var c=[];for(var d in a.state.selectedIndices[b])a.state.selectedIndices[b].hasOwnProperty(d)&&c.push(a.state.supRecords[a.state.selSupId][b][d]);return c}function q(a){var b=[];angular.forEach(a.approved,function(a){a.action="submit",b.push(a)}),angular.forEach(a.disapproved,function(a){a.action="reject",a.remarks=a.rejectionRemarks,b.push(a)}),b.length>0&&m(b)}function r(){angular.forEach(a.state.selectedIndices,function(b,c){a.selectNone(c)})}a.state={supIds:{},empInfos:{},supRecords:{},loading:!1,selSupId:null,selectedIndices:{NOT_SUBMITTED:{},SUBMITTED:{},DISAPPROVED:{},APPROVED:{},DISAPPROVED_PERSONNEL:{},SUBMITTED_PERSONNEL:{},APPROVED_PERSONNEL:{}}};var s="all";a.init=function(){k()},a.getOptionLabel=function(b){return(b==s?"All Supervisors":a.state.empInfos[b].fullName)+" - ("+(a.state.supRecords[b].SUBMITTED||[]).length+" Pending Records)"},a.multipleSups=function(){return Object.keys(a.state.supRecords).length>2},a.selectAll=function(b){for(var c=0;c<a.state.supRecords[a.state.selSupId][b].length;c++)a.state.selectedIndices[b][c]=!0},a.selectNone=function(b){a.state.selectedIndices[b]={}},a.showDetails=function(a){var b={record:a};e.open("record-details",b,!0)},a.review=function(b,c){var d=p(b),f={records:d,allowApproval:c};e.open("record-review",f,!0).then(q).then(a.selectNone)},a.hasSelections=function(b){for(var c in a.state.selectedIndices[b])if(a.state.selectedIndices[b].hasOwnProperty(c)&&a.state.selectedIndices[b][c]===!0)return!0;return!1},a.submitPrompt=function(a){var b={approved:a};return e.open("record-approval-submit",b)},a.approveSelections=function(){var b=p("SUBMITTED");b&&(b.forEach(function(a){a.action="submit"}),a.submitPrompt(b).then(function(){m(b)}))},a.remindSelections=function(a){var b=p(a);e.open("record-reminder-prompt",{records:b},!0).then(function(){return n(b)}).then(function(){e.open("record-reminder-posted",!0)})},a.resolveModal=e.resolve,a.init()}function recordReviewModal(a,b,c){function d(a,d,e){function f(){for(var b=0;b<a.records.length;b++){var d=(b+a.iSelectedRecord)%a.records.length;if("untouched"===a.getApprovalStatus(a.records[d]))return a.iSelectedRecord=d,void c.scrollToId(a.records[d].timeRecordId)}}function g(){var b=a.iSelectedRecord+1;b<a.records.length&&(a.iSelectedRecord=b)}function h(){var b=a.iSelectedRecord-1;b>=0&&(a.iSelectedRecord=b)}function i(b){if([38,39].indexOf(b.keyCode)>=0)h();else{if(!([40,41].indexOf(b.keyCode)>=0))return;g()}a.$digest()}a.iSelectedRecord=0,a.records=b.params().records,a.allowApproval=b.params().allowApproval;var j={},k={};d.addClass("custom-fit"),a.submitChanges=function(){b.open("record-approval-submit",{approved:j,disapproved:k}).then(function(){a.resolve()})},a.resolve=function(){b.resolve({approved:j,disapproved:k})},a.close=b.reject,a.cancelRecord=function(){var b=a.records[a.iSelectedRecord];delete j[b.timeRecordId],delete k[b.timeRecordId]},a.approveRecord=function(){var b=a.records[a.iSelectedRecord];a.cancelRecord(),j[b.timeRecordId]=b,f()},a.rejectRecord=function(){var c=a.records[a.iSelectedRecord];b.open("record-review-reject",{record:c},!0).then(function(b){a.cancelRecord(c),c.rejectionRemarks=b,k[c.timeRecordId]=c,f()})},a.selectRecord=function(b){a.iSelectedRecord=b},a.next=function(){f()},a.getApprovalStatus=function(a){return a.timeRecordId in j?"approved":a.timeRecordId in k?"disapproved":"untouched"},a.submissionEmpty=function(){return 0===Object.keys(j).length&&0===Object.keys(k).length};var l=angular.element(document);l.on("keydown",i),a.$on("$destroy",function(){l.off("keydown",i)})}return{templateUrl:a.ctxPath+"/template/time/record/record-review-modal",link:d}}function recordReviewRejectModal(a,b){return{templateUrl:b.ctxPath+"/template/time/record/record-reject-modal",link:function(b,c,d){b.noRemarks=!1,b.cancel=a.reject,b.submit=function(){"string"==typeof b.remarks&&b.remarks.trim()?a.resolve(b.remarks):b.noRemarks=!0}}}}function recordApproveSubmitModal(a,b){return{templateUrl:b.ctxPath+"/template/time/record/record-approve-submit-modal",link:function(b,c,d){b.approved=a.params().approved,b.approvedCount=b.approved?Object.keys(b.approved).length:0,b.disapproved=a.params().disapproved,b.disapprovedCount=b.disapproved?Object.keys(b.disapproved).length:0,b.cancel=a.reject,b.resolve=function(){a.resolve()}}}}function recordReminderPromptModal(a,b){return{templateUrl:b.ctxPath+"/template/time/record/record-reminder-modal",link:function(b,c,d){var e=a.params();b.records=e.records,b.empIds=[],b.empIdRecordMap={},b.records.forEach(function(a){var c=a.employeeId;-1===b.empIds.indexOf(c)&&b.empIds.push(c),b.empIdRecordMap.hasOwnProperty(c)||(b.empIdRecordMap[c]=[]),b.empIdRecordMap[c].push(a)}),b.reject=a.reject,b.resolve=a.resolve}}}function supplyHistoryController(a,b,c,d,e,f){function g(){var b={status:["APPROVED","REJECTED"],from:moment(a.filter.date.from).startOf("day").format(),to:moment(a.filter.date.to).endOf("day").format(),limit:a.paginate.itemsPerPage,offset:a.paginate.getOffset(),location:a.selectedLocation,issuerId:a.issuerNameToID[a.selectedIssuer]};return c.get(b,function(b){a.shipments=b.result,a.paginate.setTotalItems(b.total)})}function h(){e.get().$promise.then(j),b.get().$promise.then(k)}function i(){a.loading=!1}a.paginate=angular.extend({},f),a.loading=!0,a.shipments=null,a.locations=[],a.selectedIssuer=null,a.issuers=[],a.issuerNameToID=[],a.filter={date:{from:moment().subtract(1,"month").format("MM/DD/YYYY"),to:moment().format("MM/DD/YYYY")}},a.init=function(){a.paginate.itemsPerPage=12,g().$promise.then(h).then(i)},a.init(),a.onFilterChange=function(){a.loading=!0,a.paginate.reset(),g().$promise.then(i)},a.onPageChange=function(){a.loading=!0,g().$promise.then(i)};var j=function(b){b.result.forEach(function(b){a.locations.push(b.locId)}),l(a.locations),a.locations.unshift("All"),a.selectedLocation=a.locations[0]},k=function(b){b.result.forEach(function(b){a.issuers.push(b.fullName),a.issuerNameToID[b.fullName]=b.employeeId}),a.issuers.unshift("All"),a.selectedIssuer=a.issuers[0]},l=function(a){a.sort(function(a,b){return b>a?-1:a>b?1:0})};a.getOrderQuantity=function(a){var b=0;return angular.forEach(a.lineItems,function(a){b+=a.quantity}),b},a.viewRequisition=function(a){d.go("/supply/requisition/requisition-view",!1,"requisition="+a.requisitionId)}}function supplyOrderHistoryCtrl(a,b,c,d,e,f){function g(){return h().then(i).then(j)["finally"](k)}function h(){var a={empId:b.user.employeeId,detail:!0};return d.get(a).$promise}function i(b){var c={location:b.employee.empWorkLocation.locId,customerId:b.employee.employeeId,status:a.filter.status,from:moment(a.filter.date.from,l).startOf("day").format(),to:moment(a.filter.date.to,l).endOf("day").format(),limit:a.paginate.itemsPerPage,offset:a.paginate.getOffset()};return e.get(c,function(b){a.paginate.setTotalItems(b.total)}).$promise}function j(b){return a.requisitions=b.result,a.requisitions}function k(){a.loading=!1}var l="MM/DD/YYYY";a.STATUSES=["PENDING","PROCESSING","COMPLETED","APPROVED","REJECTED"],a.requisitions=[],a.paginate=angular.extend({},f),a.filter={date:{from:moment().subtract(1,"month").format(l),to:moment().format(l)},status:[]},a.loading=!0,a.init=function(){a.paginate.itemsPerPage=12,a.filter.status=angular.copy(a.STATUSES),g()},a.init(),a.updateRequisitions=function(){a.loading=!0,g()},a.viewRequisition=function(a){c.go("/supply/requisition/requisition-view",!1,"requisition="+a.requisitionId)}}function itemAutocompleteService(a){var b=[],c=[],d=new Map,e=function(a){b=a.result},f=function(){angular.forEach(b,function(a){c.push(a.commodityCode)})},g=function(){angular.forEach(b,function(a){d.set(a.commodityCode,a)})},h=function(){b=[],c=[],d=new Map};return{initWithAllItems:function(){return h(),a.get().$promise.then(e).then(f).then(g)},getItemFromCommodityCode:function(a){return d.get(a)},getItemAutocompleteOptions:function(){var a={options:{html:!0,focusOpen:!1,onlySelectValid:!0,outHeight:50,minLength:0,source:function(b,d){var e=c;e=a.methods.filter(e,b.term),e.length||e.push({label:"Not Found",value:""}),d(e)},messages:{noResults:"",results:function(){}}},methods:{}};return a}}}function locationAutocompleteService(a,b,c){var d=[],e=[],f=new Map,g=function(a){d=a.result},h=function(){angular.forEach(d,function(a){e.push(a.code+" ("+a.locationDescription+")")}),i(e)},i=function(a){a.sort(function(a,b){return b>a?-1:a>b?1:0})},j=function(){angular.forEach(d,function(a){f.set(a.code,a)})},k=function(){
d=[],e=[],f=new Map};return{initWithAllLocations:function(){return k(),b.get().$promise.then(g).then(h).then(j)},initWithResponsibilityHeadLocations:function(){return k(),c.get({empId:a.user.employeeId}).$promise.then(g).then(h).then(j)},getCodes:function(){return e},getCodeToLocationMap:function(){return f},isValidCode:function(a){return f.has(a)},getLocationFromCode:function(a){return f.get(a)},getLocationAutocompleteOptions:function(a){var b={options:{html:!0,focusOpen:!1,onlySelectValid:!0,outHeight:a||300,minLength:0,select:function(a,b){b.item.label=b.item.label.split("(")[0].trim(),b.item.value=b.item.value.split("(")[0].trim()},source:function(a,c){var d=e;d=b.methods.filter(d,a.term),d.length||d.push({label:"Not Found",value:""}),c(d)},messages:{noResults:"",results:function(){}}},methods:{}};return b}}}function fulfillmentEditingModal(a,b,c,d,e,f){function g(){angular.forEach(a.supplyEmployees,function(c){c.employeeId===b.user.employeeId&&(a.editableRequisition.issuer=c)})}function h(a){return a.quantity>a.item.maxQtyPerOrder}function i(a){return"SPECIAL"===a.item.visibility}function j(b){if(null==a.locationStatistics)return!1;var c=a.locationStatistics.getQuantityForLocationAndItem(a.originalRequisition.destination.locId,b.item.commodityCode);return c>b.item.suggestedMaxQty}function k(b){var c=!1;return angular.forEach(a.editableRequisition.lineItems,function(a){b.id===a.item.id&&(c=!0)}),c}a.dirty=!1,a.originalRequisition={},a.editableRequisition={},a.newLocationCode="",a.newItemCommodityCode="",a.displayRejectInstructions=!1,a.init=function(){a.originalRequisition=c.params(),a.originalRequisition.note="",a.editableRequisition=angular.copy(a.originalRequisition),a.newLocationCode=a.editableRequisition.destination.code,f.initWithAllItems()},a.init(),a.saveChanges=function(){c.resolve(d.save({id:a.originalRequisition.requisitionId},a.editableRequisition).$promise)},a.closeModal=function(){c.reject()},a.processOrder=function(){a.editableRequisition.status="PROCESSING",a.editableRequisition.processedDateTime=moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),null===a.editableRequisition.issuer&&g(),a.saveChanges()},a.completeOrder=function(){a.editableRequisition.status="COMPLETED",a.editableRequisition.completedDateTime=moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),a.saveChanges()},a.approveShipment=function(){a.editableRequisition.status="APPROVED",a.editableRequisition.approvedDateTime=moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),a.saveChanges()},a.rejectOrder=function(){a.originalRequisition.note===a.editableRequisition.note?a.displayRejectInstructions=!0:(a.editableRequisition.status="REJECTED",a.editableRequisition.rejectedDateTime=moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),a.saveChanges())},a.onUpdate=function(){a.dirty=angular.toJson(a.originalRequisition)!==angular.toJson(a.editableRequisition)},a.onLocationUpdated=function(){var b=e.getLocationFromCode(a.newLocationCode);b?a.editableRequisition.destination=b:a.editableRequisition.destination=a.originalRequisition.destination,a.onUpdate()},a.getLocationAutocompleteOptions=function(){return e.getLocationAutocompleteOptions(100)},a.calculateHighlighting=function(a){return{warn:h(a)||j(a)||i(a),bold:j(a)}},a.highlightLineItem=function(a){return a.quantity>a.item.suggestedMaxQty||"SPECIAL"===a.item.visibility},a.addItem=function(){var b=f.getItemFromCommodityCode(a.newItemCommodityCode);b&&!k(b)&&(a.editableRequisition.lineItems.push({item:b,quantity:1}),a.newItemCommodityCode="",a.onUpdate())},a.getItemAutocompleteOptions=function(){return f.getItemAutocompleteOptions()}}function supplyFulfillmentController(a,b,c,d,e,f,g,h){function i(){l(),m(),n(),o(),p()}function j(){c.get(function(b){a.supplyEmployees=b.result},function(a){})}function k(){var b=moment().year(),c=moment().month()+1;h.calculateLocationStatisticsFor(b,c).then(function(b){a.locationStatistics=b})}function l(){var c={status:"PENDING",from:moment.unix(1).format()};a.pendingSearch.response=b.get(c,function(b){a.pendingSearch.matches=b.result,a.pendingSearch.error=!1},function(b){a.pendingSearch.matches=[],a.pendingSearch.error=!0})}function m(){var c={status:"PROCESSING",from:moment.unix(1).format()};a.processingSearch.response=b.get(c,function(b){a.processingSearch.matches=b.result,a.processingSearch.error=!1},function(b){a.processingSearch.matches=[],a.processingSearch.error=!0})}function n(){var c={status:"COMPLETED",from:moment.unix(1).format()};a.completedSearch.response=b.get(c,function(b){a.completedSearch.matches=b.result,a.completedSearch.error=!1},function(b){a.completedSearch.matches=[],a.completedSearch.error=!0})}function o(){var c={status:"APPROVED",from:moment().startOf("day").format(),dateField:"approved_date_time"};a.approvedSearch.response=b.get(c,function(b){a.approvedSearch.matches=b.result,a.approvedSearch.error=!1},function(b){a.approvedSearch.matches=[],a.approvedSearch.error=!0})}function p(){var c={status:"REJECTED",from:moment().startOf("day").format(),dateField:"rejected_date_time"};a.canceledSearch.response=b.get(c,function(b){a.canceledSearch.matches=b.result,a.canceledSearch.error=!1},function(b){a.canceledSearch.matches=[],a.canceledSearch.error=!0})}function q(a){var b=!1;return angular.forEach(a.lineItems,function(a){a.quantity>a.item.maxQtyPerOrder&&(b=!0)}),b}function r(a){var b=!1;return angular.forEach(a.lineItems,function(a){"SPECIAL"===a.item.visibility&&(b=!0)}),b}function s(b){if(null==a.locationStatistics)return!1;var c=!1;return angular.forEach(b.lineItems,function(d){var e=a.locationStatistics.getQuantityForLocationAndItem(b.destination.locId,d.item.commodityCode);e>d.item.suggestedMaxQty&&(c=!0)}),c}function t(a){g.go("/supply/manage/fulfillment",!0)}function u(b){void 0!==b&&409===b.status&&(a.saveResponse=b,a.saveResponse.error=!0,e.open("500",{details:b}))}a.pendingSearch={matches:[],response:{},error:!1},a.processingSearch={matches:[],response:{},error:!1},a.completedSearch={matches:[],response:{},error:!1},a.approvedSearch={matches:[],response:{},error:!1},a.canceledSearch={matches:[],response:{},error:!1},a.saveResponse={response:{},error:!1},a.supplyEmployees=[],a.locationStatistics=null,a.init=function(){i(),j(),k()},a.init();var v=f(function(){i()},6e4);a.$on("$destroy",function(){f.cancel(v)}),a.getOrderQuantity=function(a){var b=0;return angular.forEach(a.lineItems,function(a){b++}),b},a.calculateHighlighting=function(a){return{warn:q(a)||s(a)||r(a),bold:s(a)}},a.showEditingModal=function(b){a.saveResponse.response=e.open("fulfillment-editing-modal",b).then(t)["catch"](u)},a.showImmutableModal=function(a){e.open("fulfillment-immutable-modal",a)}}function supplyReconciliationController(a,b,c,d,e,f){function g(){b.get().$promise.then(function(b){b.result.forEach(function(b){a.reconciliations[b.item_category]=b.page});var d={status:"APPROVED",from:moment().startOf("day").format(),to:moment().format(),dateField:"approved_date_time"};a.reconcilableSearch.response=c.get(d,function(b){a.reconcilableSearch.matches=b.result,a.reconcilableSearch.error=!1,angular.forEach(a.reconcilableSearch.matches,function(b){angular.forEach(b.lineItems,function(c){a.reconcilableItemMap.hasOwnProperty(c.item.id)?a.reconcilableItemMap[c.item.id].push(b):(a.reconcilableItemMap[c.item.id]=[],a.reconcilableItemMap[c.item.id].push(b),c.item.page=a.reconciliations[c.item.category.name],a.reconcilableSearch.items.push(c.item))})})},function(b){a.reconcilableSearch.matches=[],a.reconcilableSearch.items=[],a.reconcilableSearch.error=!0})})}a.selectedItem=null,a.viewItems=[],a.reconcilableSearch={matches:[],items:[],response:{},error:!1},a.currentPage=1,a.reconciliations={},a.reconcilableItemMap={},a.print=function(){f(e.print,0)},a.setSelected=function(b){a.selectedItem==b?a.selectedItem=null:a.selectedItem=b},a.isItemSelected=function(b){return a.selectedItem==b},a.getShipmentsWithItem=function(b){return a.reconcilableItemMap[b.id]},a.getOrderedQuantity=function(a,b){for(var c=a.lineItems,d=0;d<c.length;d++)if(c[d].item.id===b.id)return c[d].quantity},a.viewShipment=function(a){d.go("/supply/requisition/requisition-view",!1,"requisition="+a.requisitionId)},a.init=function(){g()},a.setCurrentPage=function(b){$("#page"+a.currentPage).css("text-decoration",""),a.currentPage=b,$("#page"+a.currentPage).css("text-decoration","underline")},a.init()}function supplyNavigationController(a,b,c,d,e,f){function g(a){return a===c.ctxPath+"/supply/order"}function h(){return f.isDestinationConfirmed()}function i(){var a=d.getSearchParam("category")||[];angular.forEach(e.getCategories(),function(b){b.selected=-1!==a.indexOf(b.name)})}var j=d.getSearchParam("category")||[];a.updateWithURL=function(a){0!=j.length&&-1!=j.indexOf(a.name)&&(a.selected=!0)},a.getCategories=function(){return e.getCategories()},a.shouldDisplayCategoryFilter=function(){return g(b.path())&&h()},a.$on("$locationChangeStart",function(b,c){a.shouldDisplayCategoryFilter&&i()}),a.onCategorySelected=function(){var a=[];angular.forEach(e.getCategories(),function(b){b.selected&&a.push(b.name)}),d.setSearchParam("category",a,!0,!1)},a.clearSelections=function(){angular.forEach(e.getCategories(),function(a){a.selected=!1}),a.onCategorySelected()}}function supplyCartController(a,b,c,d,e,f,g,h,i){a.destinationCode=null,a.destinationDescription="",a.init=function(){var b=f.getDestination();null!=b&&(a.destinationCode=b.code,a.destinationDescription=f.getDestination().locationDescription||"")},a.init(),a.myCartItems=function(){return c.getCart()},a.orderQuantityRange=function(a){return d.getAllowedQuantities(a)},a.cartHasItems=function(){return c.getCart().length>0},a.removeFromCart=function(a){c.removeFromCart(a.id)},a.submitOrder=function(){var a={customerId:g.user.employeeId,lineItems:c.getCart(),destinationId:b.getDestination().locId};e.save(a,function(a){c.reset(),f.reset(),b.resetDestination(),h.open("supply-cart-checkout-modal",a)},function(a){})},a.orderedOverRecommended=function(a){return a.quantity>a.item.maxQtyPerOrder},a.closeModal=function(){h.resolve()},a.viewOrder=function(){h.resolve()},a.resetDestination=function(){c.reset(),f.reset(),i.go("/supply/order",!0)}}function locationAllowanceService(a){function b(a,b){if(0===b.length)return a;var c=[];return angular.forEach(a,function(a){-1!==b.indexOf(a.item.category.name)&&c.push(a)}),c}function c(a,b){var c=[];return angular.forEach(a,function(a){-1!==a.item.description.indexOf(b.toUpperCase())&&c.push(a)}),c}var d=null;return{queryLocationAllowance:function(b){return a.get({id:b.locId},function(a){d=a.result.itemAllowances}).$promise},filterAllowances:function(a,d,e){var f=angular.copy(a);return void 0!==d&&null!==d&&d.length>0&&(f=b(f,d)),void 0!==e&&null!==e&&e.length>0&&(f=c(f,e)),f},getAllowances:function(){return d},getAllowedQuantities:function(a){a.maxQtyPerOrder>50&&(a.maxQtyPerOrder=50);for(var b=[],c=1;c<=a.maxQtyPerOrder;c++)b.push(c);return b}}}function orderDestinationService(a,b,c,d){var e=void 0;return{queryDefaultDestination:function(){return e?void 0:c.get({empId:a.user.employeeId,detail:!0},function(a){e=a.employee.empWorkLocation.code}).$promise},isDestinationConfirmed:function(){return null!==b.getDestination()&&void 0!==b.getDestination()},setDestination:function(a){return d.isValidCode(a)?(b.addDestination(d.getLocationFromCode(a)),!0):!1},reset:function(){e=void 0,b.resetDestination()},getDefaultCode:function(){return e},getDestination:function(){return b.getDestination()}}}function supplyOrderController(a,b,c,d,e,f,g,h,i,j){function k(){f.initWithResponsibilityHeadLocations().then(h.queryDefaultDestination).then(l).then(n)}function l(){a.destinationCode=h.getDefaultCode()}function m(){a.destinationDescription=h.getDestination().locationDescription||""}function n(){a.state=a.states.SELECTING_DESTINATION}function o(){a.state=a.states.LOADING,a.destinationCode=h.getDestination().code,g.queryLocationAllowance(h.getDestination()).then(q).then(r).then(t).then(m).then(p)}function p(b){a.updateSort()}function q(a){v=a.result.itemAllowances}function r(){a.displayAllowances=g.filterAllowances(v,a.filter.categories,a.filter.searchTerm),a.displayAllowances=j.alphabetizeAllowances(a.displayAllowances)}function s(){a.filter.searchTerm="",r()}function t(){a.state=a.states.SHOPPING}function u(){a.filter.categories=c.getSearchParam("category")||[],a.paginate.currPage=c.getSearchParam("page")||1,c.setSearchParam("page",a.paginate.currPage,!0,!0)}a.state={},a.sorting={Name:0,Category:10},a.sortBy=a.sorting.Alphabet,a.states={LOADING:0,SELECTING_DESTINATION:5,SHOPPING:10},a.displaySorting=Object.getOwnPropertyNames(a.sorting),a.paginate=angular.extend({},e),a.filter={searchTerm:"",categories:[]};var v=[];a.displayAllowances=[],a.destinationCode="",a.destinationDescription="",a.init=function(){a.state=a.states.LOADING,a.paginate.itemsPerPage=16,u(),h.isDestinationConfirmed()?o():k()},a.init(),a.search=function(){r()},a.reset=function(){s()},a.onPageChange=function(){c.setSearchParam("page",a.paginate.currPage,!0,!1)},a.$on("$locationChangeStart",function(a,c){c.indexOf(b.ctxPath+"/supply/order")>-1&&(u(),r())}),a.addToCart=function(b){return"more"===b.selectedQuantity?void a.quantityChanged(b):void(isNaN(b.selectedQuantity)||d.isOverOrderAllowance(b.item,b.selectedQuantity)||(d.isItemInCart(b.item.id)||"SPECIAL"!==b.visibility?d.addToCart(b.item,b.selectedQuantity):i.open("special-order-item-modal",{allowance:b})))},a.isInCart=function(a){return d.isItemInCart(a.id)},a.getAllowedQuantities=function(a){var b=g.getAllowedQuantities(a);return b.push("more"),b},a.quantityChanged=function(a){"more"===a.selectedQuantity&&i.open("order-more-prompt-modal",{allowance:a}).then(function(a){i.open("order-custom-quantity-modal",{item:a.item})})},a.confirmDestination=function(){var b=h.setDestination(a.destinationCode);b&&o()},a.$on("$locationChangeStart",function(b,c){a.updateSort()}),a.getLocationAutocompleteOptions=function(){return f.getLocationAutocompleteOptions()},a.resetDestination=function(a){d.reset(),h.reset(),c.go("/supply/order",!0)},a.backHidden=function(){return a.state==a.states.SELECTING_DESTINATION},a.updateSort=function(){var b=c.getSearchParam("sortBy")||[];(0==b.length||b[0]!=a.sortBy)&&c.setSearchParam("sortBy",a.sortBy,!0,!1);var d=angular.copy(a.displayAllowances);a.sorting[a.sortBy]==a.sorting.Name?d.sort(function(a,b){return a.item.description<b.item.description?-1:a.item.description>b.item.description?1:0}):a.sorting[a.sortBy]==a.sorting.Category&&d.sort(function(a,b){return a.item.category.name<b.item.category.name?-1:a.item.category.name>b.item.category.name?1:0}),a.displayAllowances=d}}function supplyViewController(a,b,c,d,e,f){function g(){for(var b in a.shipment)a.shipment.hasOwnProperty(b)&&a.requisitionHistory.versions.push(a.shipment[b])}function h(){for(var b=0;b<a.requisitionHistory.versions.length;b++)0===b?a.requisitionHistory.versions[b].name="Original":b===a.requisitionHistory.versions.length-1?a.requisitionHistory.versions[b].name="Current":a.requisitionHistory.versions[b].name=b+1}a.requisitionResponse={},a.requisitionHistory={versions:[]},a.selectedVersion={},a.shipemnt={},a.init=function(){var d=c.getSearchParam("requisition");a.requisitionResponse=b.get({id:d}),a.requisitionResponse.$promise.then(i).then(j).then(k).then(l)["catch"](m)};var i=function(b){a.shipment=b.result},j=function(){var a=c.getSearchParam("print");"true"===a&&e(function(){d.print()})},k=function(){g(),h(),a.requisitionHistory.versions.reverse()},l=function(){a.selectedVersion=a.requisitionHistory.versions[0]},m=function(a){};a.init(),a.sortSelectedVersionLineItems=function(){return a.selectedVersion&&a.selectedVersion.lineItems?f.alphabetizeLineItems(a.selectedVersion.lineItems):void 0},a.displayIssuedDate=function(a){return"COMPLETED"===a.status||"APPROVED"===a.status}}function supplyCookieService(a,b){function c(a){return JSON.stringify(a)}function d(a){return JSON.parse(a)}function e(a){return btoa(a)}function f(a){return atob(a)}var g=b.user.employeeId;return{addCart:function(b){var d=e(c(b)),f=a.get(g);(null!=f||void 0!=f)&&a.remove(g),a.put(g,d)},getCart:function(){var b=a.get(g);return null==b||void 0==b?[]:d(f(b))},resetCart:function(){var b=a.get(g);(null!=b||void 0!=b)&&a.remove(g)},addDestination:function(b){var d="destination"+g,e=a.get(d);(null!=e||void 0!=e)&&a.remove(d),a.put(d,c(b))},getDestination:function(){var b="destination"+g,c=a.get(b);return null==c||void 0==c?null:d(c)},resetDestination:function(){var b="destination"+g,c=a.get(b);(null!=c||void 0!=c)&&a.remove(b)}}}function supplyLocationStatisticsService(a,b){function c(a){this.locationStatisticsMap=a,this.getQuantityForLocationAndItem=function(b,c){return a[b].itemQuantities[c]}}return{calculateLocationStatisticsFor:function(d,e){return a(function(a,f){var g={year:d,month:e};b.get(g,function(b){a(new c(b.result.items))})})}}}var essCore=angular.module("essCore",[]),essApi=angular.module("essApi",["essCore"]),essMyInfo=angular.module("essMyInfo",["essApi"]),essTime=angular.module("essTime",["essApi"]),essSupply=angular.module("essSupply",["essApi","ngCookies"]),essHelp=angular.module("essHelp",["essApi"]),essApp=angular.module("ess",["ngRoute","ngResource","ngAnimate","essMyInfo","essTime","essSupply","essHelp","floatThead","angularUtils.directives.dirPagination","ui.autocomplete","nsPopover"]);essCore.constant("appProps",globalProps),essCore.run(["$cookies",function(a){if(void 0===a.get("appVersion")||a.get("appVersion")!=globalProps.releaseVersion){var b=a.getAll();angular.forEach(b,function(b,c){a.remove(c)})}a.put("appVersion",globalProps.releaseVersion)}]),essCore.factory("httpTimeoutChecker",["appProps",function(a){return{request:function(b){if("true"==globalProps.timeoutExempt)return b;var c='<div id="timeout-confirm" title="Inactive Session Timeout">  <p style="padding-left: 35px;padding-top: 10px;"><span class="ui-icon ui-icon-alert" ></span><span style="font-size: large; align-content: center;">Due to inactive, this session is about to timeout in <span id="tick">60</span>  seconds, do you want to continues your work?</span></p></div>';$("#timeout-confirm").length<=0&&$("body").append(c),$("#timeout-confirm").hide(),$("#timeout-confirm").dialog(),$("#timeout-confirm").dialog("close");var d=5,e=0;if(localStorage.setItem("alerted","false"),null==localStorage.getItem("hb")||window.location.pathname.split("/")[1]!=localStorage.getItem("hb").split("/")[1]){localStorage.setItem("hb",window.location.pathname);var f=setInterval(function(){e+=d,$.ajax({type:"GET",url:a.apiPath+"/timeout/ping.json?sessionId="+window.globalProps.sessionId+"&idelTime="+e,success:function(b){if(b.message>0&&"false"==localStorage.getItem("alerted")){localStorage.setItem("alerted","true");var c=60,d=setInterval(function(){c>=0?($("#tick").text(c),c-=1):$.ajax({type:"GET",url:a.apiPath+"/timeout/ping.json?sessionId="+window.globalProps.sessionId+"&idelTime=-1",success:function(b){window.location.replace(a.loginUrl),window.location.reload(!0)}})},1e3);$("#timeout-confirm").dialog({resizable:!1,height:240,width:400,modal:!0,closeOnEscape:!1,open:function(a,b){$(".ui-dialog-titlebar-close",b.dialog|b).hide(),$(".ui-widget-overlay").attr("style","position: fixed;top: 0;left: 0; width: 100%;height: 100%; background: #666666 url(ui-bg_diagonals-thick_20_666666_40x40.png) 50% 50% repeat;opacity: .50;filter:Alpha(Opacity=50); ")},close:function(){},buttons:{Continue:function(){$.ajax({type:"GET",url:a.apiPath+"/timeout/ping.json?sessionId="+window.globalProps.sessionId+"&idelTime="+e}),$(this).dialog("close"),e=0,localStorage.setItem("alerted","false"),c=60,clearInterval(d)}}})}}})},1e3*d);$(document).on("change click keydown keypress keyup load  resize scroll select submit",function(){e=0}),window.onbeforeunload=function(a){localStorage.removeItem("hb"),clearInterval(f)}}return b}}}]),essCore.config(["$httpProvider",function(a){a.interceptors.push("httpTimeoutChecker")}]),essCore.config(["$routeProvider","$httpProvider",function(a,b){b.defaults.headers.common["Cache-Control"]="no-cache, no-store, max-age=0, must-revalidate",b.defaults.headers.common.Pragma="no-cache",b.defaults.headers.common.Expires="-1"}]);var essApi=angular.module("essApi");essApi.factory("PayPeriodApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/periods/:periodType")}]),essApi.factory("HolidayApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/holidays")}]),essApi.factory("TimeRecordApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords")}]),essApi.factory("ActiveTimeRecordsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords/active")}]),essApi.factory("ActiveYearsTimeRecordsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords/activeYears")}]),essApi.factory("SupervisorTimeRecordsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords/supervisor")}]),essApi.factory("SupervisorTimeRecordCountsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords/supervisor/count")}]),essApi.factory("TimeRecordReminderApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/timerecords/reminder")}]),essApi.factory("AttendanceRecordApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/attendance/records")}]),essApi.factory("SupervisorEmployeesApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supervisor/employees")}]),essApi.factory("SupervisorChainApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supervisor/chain")}]),essApi.factory("SupervisorOverridesApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supervisor/overrides")}]),essApi.factory("SupervisorGrantsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supervisor/grants")}]),essApi.factory("AccrualPeriodApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/accruals")}]),essApi.factory("AccrualHistoryApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/accruals/history")}]),essApi.factory("EmpInfoApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/employees.json")}]),essApi.factory("EmpActiveYearsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/employees/activeDates")}]),essApi.factory("EmpActiveYearsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/employees/activeYears")}]),essApi.factory("EmpTransactionsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/empTransactions/")}]),essApi.factory("EmpTransactionSnapshotApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/empTransactions/snapshot")}]),essApi.factory("EmpTransactionCurrentSnapshotApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/empTransactions/snapshot/current")}]),essApi.factory("EmpTransactionTimelineApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/empTransactions/timeline")}]),essApi.factory("AllowanceApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/allowances")}]),essApi.factory("MiscLeaveGrantApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/miscleave/grants")}]),essApi.factory("EmpCheckHistoryApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/paychecks.json")}]),essApi.factory("LocationApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/locations.json")}]),essApi.factory("SupplyItemsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/items.json")}]),essApi.factory("SupplyLocationAllowanceApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/location/allowance/:id.json",{id:"@id"})}]),essApi.factory("SupplyDestinationApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/destinations/:empId.json",{empId:"@empId"})}]),essApi.factory("SupplyRequisitionApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/requisitions.json")}]),essApi.factory("SupplyRequisitionByIdApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/requisitions/:id.json",{id:"@id"})}]),essApi.factory("SupplyRequisitionHistoryApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/requisitions/history/:id.json",{id:"@id"})}]),essApi.factory("SupplyRequisitionOrderHistoryApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/requisitions/orderHistory.json")}]),essApi.factory("SupplyReconciliationApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/reconciliation.json")}]),essApi.factory("SupplyEmployeesApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/employees")}]),essApi.factory("SupplyLocationStatisticsApi",["$resource","appProps",function(a,b){return a(b.apiPath+"/supply/statistics/locations.json")}]);var essApp=angular.module("ess");essApp.directive("essNavigation",["$route","$routeParams","$location",function(a,b,c){return{restrict:"A",link:function(a,b,d){b.on("click","ul li.main-topic",function(a){$(this).hasClass("active")||(b.find(".main-topic.active").removeClass("active"),b.find(".sub-topic-list.active").removeClass("active"),$(this).addClass("active"),$(this).next("li").children("ul.sub-topic-list").addClass("active"))}),a.$on("$routeChangeStart",function(){b.find(".main-topic.active, .sub-topic-list.active, .sub-topic.active").removeClass("active");var a=b.find(".sub-topic a[href='"+c.$$path+"']");if(1==a.length){var d=a.parent(),e=d.parent(),f=e.parent().prev();d.add(e).add(f).addClass("active")}})}}}]);var essApp=angular.module("ess");essApp.config(function(a,b){var c=globalProps.ctxPath;a.when(c+"/myinfo",{redirectTo:c+"/myinfo/personnel/summary"}),a.when(c+"/myinfo/personnel/summary",{templateUrl:c+"/template/myinfo/personnel/summary"}),a.when(c+"/myinfo/personnel/transactions",{templateUrl:c+"/template/myinfo/personnel/transactions"}),a.when(c+"/myinfo/payroll/checkhistory",{templateUrl:c+"/template/myinfo/payroll/checkhistory"}),a.when(c+"/time",{redirectTo:c+"/time/record/entry"}),a.when(c+"/time/record/entry",{templateUrl:c+"/template/time/record/entry",reloadOnSearch:!1}),a.when(c+"/time/record/history",{templateUrl:c+"/template/time/record/history"}),a.when(c+"/time/record/emphistory",{templateUrl:c+"/template/time/record/emphistory"}),a.when(c+"/time/record/manage",{templateUrl:c+"/template/time/record/manage",reloadOnSearch:!1}),a.when(c+"/time/record/grant",{templateUrl:c+"/template/time/record/grant"}),a.when(c+"/time/period/calendar",{templateUrl:c+"/template/time/period/calendar"}),a.when(c+"/time/accrual/history",{templateUrl:c+"/template/time/accrual/history",reloadOnSearch:!1}),a.when(c+"/time/accrual/projections",{templateUrl:c+"/template/time/accrual/projections"}),a.when(c+"/supply",{redirectTo:c+"/supply/order"}),a.when(c+"/supply/order",{templateUrl:c+"/template/supply/order",reloadOnSearch:!1}),a.when(c+"/supply/order/cart",{templateUrl:c+"/template/supply/order/cart",resolve:{locAutocomplete:["SupplyLocationAllowanceService","SupplyCookieService",function(a,b){return null!==b.getDestination()?a.queryLocationAllowance(b.getDestination()):void 0}]}}),a.when(c+"/supply/manage/fulfillment",{templateUrl:c+"/template/supply/manage/fulfillment",resolve:{locAutocomplete:["SupplyLocationAutocompleteService",function(a){return a.initWithAllLocations()}]}}),a.when(c+"/supply/manage/reconciliation",{templateUrl:c+"/template/supply/manage/reconciliation"}),a.when(c+"/supply/history/history",{templateUrl:c+"/template/supply/history/history"}),a.when(c+"/supply/order-history",{templateUrl:c+"/template/supply/order-history"}),a.when(c+"/supply/requisition/requisition-view",{templateUrl:c+"/template/supply/requisition/requisition-view"}),a.when(c+"/help/ta/plan",{templateUrl:c+"/template/help/ta/plan"}),a.otherwise({templateUrl:c+"/template/404"}),b.html5Mode(!0),b.hashPrefix("!")}),essApp.animation(".view-animate",function(){return{enter:function(a,b){return a.hide(),a.delay(150).fadeIn(300,b),function(){a.stop()}},leave:function(a,b){return a.fadeOut(100,b),function(){a.stop()}}}});var essApp=angular.module("ess");essApp.controller("MainCtrl",["$scope","$http","$route","$routeParams","$location",function(a,b,c,d,e){a.$route=c,a.$location=e,a.$routeParams=d}]);var essApp=angular.module("ess");essApp.filter("activeInactive",function(){return function(a){return"A"===a||"a"===a?"Active":"Inactive"}});var essApp=angular.module("ess");essApp.directive("badge",["$rootScope","badgeService",function(a,b){return{restrict:"AE",scope:{badgeId:"&",hideEmpty:"&"},template:'<div class="badge" ng-if="!hideEmpty || badgeValue">{{badgeValue}}</div>',link:function(a,c,d){a.$watch(function(){return b.badges[d.badgeId]},function(b){a.badgeValue=b})}}}]);var essApp=angular.module("ess");essApp.factory("badgeService",["appProps",function(a){var b={badges:{}};return b.setBadgeValue=function(a,c){b.badges[a]=c},b}]);var essApp=angular.module("ess");essApp.directive("datepicker",[function(){return{restrict:"AE",scope:{stepMonths:"@",inline:"@",defaultDate:"@",beforeShowDay:"&?",fromDate:"=?",toDate:"=?"},link:function(a,b,c){function d(b){return a.fromDate?!moment(a.fromDate).isAfter(b):a.toDate?!moment(a.toDate).isBefore(b):!0}function e(a){var b=[!0];return"function"==typeof g&&(b=g(a)),b[0]=b[0]&&d(a),b}var f=a.defaultDate?a.defaultDate:new Date,g=void 0;"function"==typeof a.beforeShowDay&&(g=a.beforeShowDay()),b.datepicker({showOn:"button",buttonImage:"/assets/img/calendar.png",buttonImageOnly:!0,inline:a.inline||!1,stepMonths:a.stepMonths||1,defaultDate:f,beforeShowDay:e}),"false"===a.stepMonths&&b.find(".ui-datepicker-prev, .ui-datepicker-next").remove()}}}]),angular.module("ess").directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}});var essApp=angular.module("ess");essApp.directive("essNotification",[function(){return{restrict:"AE",scope:{level:"@",title:"@",message:"@",dialog:"@",dialogShow:"@"},transclude:!0,template:'<div class="ess-notification {{level}}"><h2 ng-if="title" ng-bind="title"></h2><p ng-if="message" ng-bind="message"></p><ng-transclude></ng-transclude></div>',link:function(a,b,c){"true"===a.dialog&&($elem=jQuery(b),$elem&&$elem.dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0}),a.$watch("dialogShow",function(a,b){"true"===a&&$elem.dialog("open")}))}}}]);var essApp=angular.module("ess");essApp.directive("essChart",[function(){return{restrict:"AE",link:function(a,b,c){b.highcharts({})}}}]);var essApp=angular.module("ess");essApp.directive("internalErrorModal",["modals",function(a){return{template:'<section id="internal-error-modal" title="Internal Error"><h1>Internal Error</h1><p class="internal-error-text">We are sorry to report that an error occurred on the ESS server while processing your request.<br>Please contact the STS Help Line at (518) 455-2011 and notify us of this issue so that we can fix it!</p><pre class="internal-error-details" ng-show="showDetails">{{details | json}}</pre><div class="button-container"><input type="button" class="reject-button" ng-click="showDetails = !showDetails" value="{{showDetails ? \'Hide\' : \'Show\'}} Details"/><input type="button" class="reject-button" ng-click="close()" value="OK"/></div></section>',link:function(b,c,d){b.showDetails=!1,b.details=a.params().details,b.close=a.reject}}}]);var essApp=angular.module("ess");essApp.directive("loaderIndicator",[function(){return{restrict:"A",template:'<div class="dot dot1"></div><div class="dot dot2"></div><div class="dot dot3"></div><div class="dot dot4"></div>',link:function(a,b,c){}}}]),angular.module("ess").service("LocationService",["$location","$window","$anchorScroll","appProps",locationService]);var essApp=angular.module("ess");essApp.directive("modalContainer",["$rootScope","$document","modals",function(a,b,c){function d(d,e){function f(){d.top=d.openModals[d.openModals.length-1],d.top?g():h()}function g(){var a=angular.element("html");a.addClass("overflow-hidden")}function h(){var a=angular.element("html");a.removeClass("overflow-hidden");
}d.openModals=[],d.top=null,d.isOpen=function(a){return d.openModals.indexOf(a)>=0};var i=e.find("#modal-backdrop")[0];i.onclick=function(a){i===a.target&&d.$apply(c.softReject)},b.bind("keyup",function(a){27===a.keyCode&&d.$apply(c.softReject)}),a.$on("modals.open",function(a,b){d.openModals.push(b),f()}),a.$on("modals.close",function(a){d.openModals.pop(),f()})}return{template:'<div id="modal-container" ng-show="top">  <div id="modal-backdrop"></div>  <div id="common-modals">    <div internal-error-modal ng-if="isOpen(\'500\')"></div>  </div>  <ng-transclude></ng-transclude></div>',transclude:!0,link:d}}]),essApp.directive("modal",function(){return{scope:{viewName:"@",isOpen:"&"},transclude:!0,template:'<div class="modal" ng-if="isOpen(\'record-details\')" ng-class="{\'background-modal\': top !== viewName}">  <ng-transclude></ng-transclude></div>',link:function(a){}}});var essApp=angular.module("ess");essApp.service("modals",["$rootScope","$q",function(a,b){function c(c,d,e){var f={deferred:b.defer(),params:d,softRejectable:e===!0};return a.$emit("modals.open",c),i.push(f),f.deferred.promise}function d(){var a=i[i.length-1];return a?a.params||{}:{}}function e(b){var c=i.pop();c&&(c.deferred.reject(b),a.$emit("modals.close"))}function f(a){for(;i.length>0;)e(a)}function g(a){var b=i[i.length-1];b&&b.softRejectable&&e(a)}function h(b){var c=i.pop();c&&(c.deferred.resolve(b),a.$emit("modals.close"))}var i=[];return{open:c,params:d,reject:e,rejectAll:f,softReject:g,resolve:h}}]);var essApp=angular.module("ess");essApp.filter("moment",["$filter",function(a){return function(a,b,c){return a?moment(a).format(b):"undefined"!=typeof c?c:"--"}}]),essApp.filter("momentFromNow",function(){return function(a,b,c){return b=b===!0,a?moment(a).fromNow(b):"undefined"!=typeof c?c:"--"}}),essApp.filter("momentCmp",function(){return function(a,b,c,d){switch("now"===c&&(c=moment()),b){case"eq":case"=":return moment(a).isSame(c,d);case"gt":case">":return moment(a).isAfter(c,d);case"lt":case"<":return moment(a).isBefore(c,d);default:return!1}}}),essApp.filter("momentIsDOW",function(){return function(a,b){return b.constructor!==Array&&(b=[b]),b.indexOf(moment(a).day())>=0}});var essApp=angular.module("ess");essApp.filter("not",function(){return function(a){return!a}});var essApp=angular.module("ess");essApp.directive("odometer",[function(){return{restrict:"AE",scope:{duration:"=odometerDuration",format:"=odometerFormat",value:"@value"},link:function(a,b,c){var d=new Odometer({el:b[0],value:a.value||0,animation:"count",duration:a.duration||500,format:a.format||"(,ddd).dd"});c.$observe("value",function(a){d.update(a)})}}}]);var essApp=angular.module("ess");essApp.factory("PaginationModel",function(){return{firstPage:1,currPage:1,lastPage:1,itemsPerPage:6,totalItems:0,setTotalItems:function(a){this.totalItems=a,this.lastPage=Math.ceil(this.totalItems/this.itemsPerPage),this.currPage>this.lastPage&&(this.currPage=1)},reset:function(){this.currPage=1},needsPagination:function(){return this.totalItems>this.itemsPerPage},getOffset:function(){return this.itemsPerPage*(this.currPage-1)+1},getLimit:function(){return this.itemsPerPage},nextPage:function(){this.currPage+=1},hasNextPage:function(){return this.currPage<this.lastPage},prevPage:function(){this.currPage=Math.max(this.currPage-1,0)},hasPrevPage:function(){return this.currPage>this.firstPage},toLastPage:function(){this.currPage=this.lastPage},toFirstPage:function(){this.currPage=this.firstPage}}}),angular.module("ess").service("promiseUtils",["$q",promiseUtilsService]);var essApp=angular.module("ess");essApp.filter("round",function(){return function(a,b,c){b=Math.abs(b||1),c=isNaN(c)?0:c;var d=Math.round;c>0?d=Math.ceil:0>c&&(d=Math.floor);var e=1/b;return d(a*e)/e}});var essApp=angular.module("ess");essApp.directive("textAutoHeight",["$timeout",function(a){return{restrict:"A",scope:{text:"="},link:function(b,c,d){a(function(){var d=c[0].offsetHeight,e=parseInt(c.css("paddingLeft"))||0,f=parseInt(c.css("paddingRight"))||0,g=angular.element("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:c[0].offsetWidth-e-f,fontSize:c.css("fontSize"),fontFamily:c.css("fontFamily"),lineHeight:c.css("lineHeight"),resize:"none"});b.$watch(function(){return c[0].offsetWidth},function(b,d){b!==d&&a(function(){var a=parseInt(c.css("paddingLeft"))||0,d=parseInt(c.css("paddingRight"))||0;g.css("width",b-a-d)},50)}),angular.element(document.body).append(g);var h=function(){var a=function(a,b){for(var c=0,d="";b>c;c++)d+=a;return d},b=c.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/\s{2,}/g,function(b){return a("&nbsp;",b.length-1)+" "});g.html(b),c.css("height",Math.max(g[0].offsetHeight+10,d)+"px")};c.bind("keyup keydown keypress change",h),h()},100)}}}]);var essApp=angular.module("ess");essApp.directive("togglePanel",[function(){return{restrict:"E",scope:{label:"@",extraClasses:"@",callback:"&",renderClosed:"@"},replace:!0,transclude:!0,template:'<div class="content-container {{extraClasses}}" ng-class="{\'open\': open}">   <h1 class="toggle-panel-label" ng-click="toggle()">{{label}}</h1>   <div ng-if="opened || renderClosed" ng-show="open" class="panel-content" ng-cloak ng-transclude></div></div>',link:function(a,b,c){a.opened=!1,a.toggle=function(){a.open=!a.open,a.callback&&a.callback(a.open)},a.renderClosed="true"==a.renderClosed,a.$watch(c.open,function(b){a.open=b}),a.$watch(c.showTip,function(b){a.showTip=b}),a.$watch("open",function(c,d){var e=b.children(".panel-content");c?e.slideDown(200):e.slideUp(200),a.opened=c||a.opened})}}}]),angular.module("ess").filter("zeroPad",zeroPadFilter);/*! Login Page */
var essApp=angular.module("ess");essApp.factory("LoginApi",["$resource","appProps",function(a,b){return a(b.ctxPath+b.loginUrl,{},{login:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}})}]),essApp.controller("LoginController",["$scope","$http","$window","appProps","LoginApi",function(a,b,c,d,e){a.credentials={username:"",password:"",rememberMe:!1},a.activeView=1,a.showError=!1,a.errorFields={username:!1,password:!1,reset:function(){this.username=!1,this.password=!1}},a.errorMessage="",a.loginInProgress=!1,a.isActiveView=function(a){return this.activeView===a},a.setActiveView=function(a){this.activeView=a},a.validate=function(){if(a.errorFields.reset(),a.showError=!1,a.credentials.username){if(a.credentials.password)return!0;a.errorMessage="Please enter your password.",a.errorFields.password=!0}else a.errorMessage="Please enter your username.",a.errorFields.username=!0;return a.showError=!0,!1},a.login=function(){a.validate()&&(a.loginInProgress=!0,e.login($.param(a.credentials),function(b,d){b&&(b.authenticated===!0?c.location.href=b.redirectUrl:(a.errorMessage=b.message,a.showError=!0,"UNKNOWN_ACCOUNT"==b.status?a.errorFields.username=!0:"INCORRECT_CREDENTIALS"==b.status&&(a.errorFields.password=!0),a.loginInProgress=!1))},function(b){a.loginInProgress=!1,alert("There was an issue logging in. Please try again.")}))}}]);var essMyInfo=angular.module("essMyInfo");essMyInfo.controller("EmpCheckHistoryCtrl",["$scope","$filter","appProps","EmpCheckHistoryApi","EmpActiveYearsApi","modals",function(a,b,c,d,e,f){function g(b){a.ytd=angular.extend({},o);for(var c=0;c<b.length;c++){var d=b[c];a.ytd.gross+=d.grossIncome,a.ytd.directDeposit+=d.directDepositAmount,a.ytd.check+=d.checkAmount;for(var e in d.deductions)d.deductions.hasOwnProperty(e)&&k(d.deductions[e])}a.ytd.check>0&&(a.checkPresent=!0),a.ytd.directDeposit>0&&(a.dirDepositPresent=!0)}function h(b){var c=[],d={};angular.forEach(b,function(a){angular.forEach(a.deductions,function(a){a.code&&!d.hasOwnProperty(a.code)&&(c.push(a),d[a.code]=!0)})}),a.deductionCols=c.sort(function(a,b){return n(a)-n(b)}).map(function(a){return a.description})}function i(a){for(var b=0;b<a.length;b++){var c=a[b].deductions;for(var d in c)c.hasOwnProperty(d)&&j(c[d])}}function j(b){a.deductionMap.hasOwnProperty(b.description)||(a.deductionMap[b.description]=!0)}function k(b){a.ytd[b.description]?a.ytd[b.description]+=b.amount:a.ytd[b.description]=b.amount}function l(b){for(var c=0;c<b.length;c++)for(var d in a.deductionMap)a.deductionMap.hasOwnProperty(d)&&(b[c].deductions.hasOwnProperty(d)||(b[c].deductions[d]=m()))}function m(){return{amount:0}}function n(b){var c=a.deductionCodes.indexOf(b.code);return 0>c?Number.MAX_VALUE:c}a.deductionMap={},a.deductionCodes=[5,6,8,7,11,514,12,546,548,502,519,301,303,302,410,321,416,418,10,661,663,18,9,4,850,851,3,326,327,427,355,422,421,428,0].map(function(a){return b("zeroPad")(a,3)}),a.deductionCols=[],a.checkHistory={searching:!1,useFiscalYears:!1,recordYears:null,recordFiscalYears:null,year:null},a.dirDepositPresent=!1,a.checkPresent=!1;var o={gross:0,directDeposit:0,check:0};a.ytd=null,a.init=function(){a.checkHistory.recordYears=c.empActiveYears,a.checkHistory.year=a.checkHistory.recordYears[a.checkHistory.recordYears.length-1],a.getRecords(),a.getActiveDates()},a.getRecords=function(){a.checkHistory.searching=!0,a.paychecks=[];var b=c.user.employeeId,e={empId:b,year:a.checkHistory.year,fiscalYear:a.checkHistory.useFiscalYears};d.get(e,function(b){a.paychecks=b.paychecks.sort(function(a,b){return new Date(a.checkDate)-new Date(b.checkDate)}),i(b.paychecks),l(b.paychecks),g(b.paychecks),h(b.paychecks),a.checkHistory.searching=!1},function(b){a.checkHistory.searching=!1,f.open("500",{details:b})})},a.getActiveDates=function(){e.get({empId:c.user.employeeId,fiscalYear:!0},function(b){a.checkHistory.recordFiscalYears=b.activeYears},function(a){f.open("500",{details:a})})},a.onFiscalYearSwitch=function(){var b=a.checkHistory.useFiscalYears?a.checkHistory.recordFiscalYears:a.checkHistory.recordYears;a.checkHistory.year=b[b.length-1],a.getRecords()},a.isSignificantChange=function(a,b){return"undefined"!=typeof b&&Math.abs(a-b)>.03?!0:!1},a.init()}]);var essMyInfo=angular.module("essMyInfo");essMyInfo.filter("formatDeductionHeader",function(){return function(a,b){return null!==a?a.replace(/\w\S*/g,function(a){return a=a.replace(":",""),a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):void 0}});var essMyInfo=angular.module("essMyInfo");essMyInfo.controller("EmpSummaryCtrl",["$scope","$http","appProps","EmpInfoApi","EmpActiveYearsApi","EmpTransactionsApi","EmpTransactionCurrentSnapshotApi","modals",function(a,b,c,d,e,f,g,h){a.state={empId:c.user.employeeId,emp:null},a.fetchEmployeeData=function(){d.get({empId:a.state.empId,detail:!0},function(b){b.success&&(a.state.emp=b.employee),g.get({empId:a.state.empId},function(b){b.success&&(a.state.emp.snapshot=b.snapshot.items)})})},a.init=function(){a.fetchEmployeeData()},a.init()}]);var essMyInfo=angular.module("essMyInfo");essMyInfo.controller("EmpTransactionHistoryCtrl",["$scope","$http","appProps","$q","EmpTransactionTimelineApi","modals",function(a,b,c,d,e,f){a.state={empId:c.user.employeeId,timeline:{}},a.getTimeline=function(){var b=d.defer();return e.get({empId:a.state.empId},function(c){if(c.success&&c.total>0){var d={};angular.forEach(c.transactions.reverse(),function(b){a.state.timeline[b.effectDate]||(a.state.timeline[b.effectDate]=[]),d[b.effectDate]||(d[b.effectDate]={}),d[b.effectDate][b.transCode]||(a.state.timeline[b.effectDate].push(b),d[b.effectDate][b.transCode]=!0)}),d=null}else a.state.timeline=!1;b.resolve()},function(c){a.state.timeline=!1,f.open("500",{details:c}),b.reject("Failed to retrieve timeline.")}),b},a.init=function(){a.getTimeline()}()}]);var essMyInfo=angular.module("essMyInfo");essMyInfo.filter("payTypeFilter",function(){return function(a){switch(a){case"RA":return"Regular Annual";case"SA":return"Special Annual";case"TE":return"Temporary Payroll"}return a}});var essTime=angular.module("essTime");essTime.controller("AccrualHistoryCtrl",["$scope","$timeout","appProps","AccrualHistoryApi","EmpActiveYearsApi","EmpInfoApi","modals","AccrualUtils",accrualHistoryCtrl]);var essTime=angular.module("essTime");essTime.controller("AccrualProjectionCtrl",["$scope","$timeout","appProps","AccrualHistoryApi","EmpInfoApi","modals","AccrualUtils",accrualProjectionCtrl]),angular.module("essTime").service("AccrualUtils",accrualUtils);var essTime=angular.module("essTime");essTime.controller("GrantPrivilegesCtrl",["$scope","$http","appProps","SupervisorChainApi","SupervisorGrantsApi","SupervisorOverridesApi","modals",function(a,b,c,d,e,f,g){a.state={empId:c.user.employeeId,selectedGrantee:null,grantees:null,granteeMap:null,granters:[],modified:!1,fetched:!1,saving:!1,saved:!1},a.init=function(){a.state.selectedGrantee=null,a.state.grantees=[],a.state.granteeMap={},a.state.granters=[],a.state.modified=a.state.fetched=a.state.saving=a.state.saved=!1,d.get({empId:a.state.empId},function(b){1==b.success&&angular.forEach(b.result.supChain,function(b){b.granted=!1,b.grantStart=b.grantEnd=null,a.state.grantees.push(b),a.state.granteeMap[b.employeeId]=b})}).$promise.then(function(b){return e.get({supId:a.state.empId},function(b){b.success&&angular.forEach(b.grants,function(b){var c=b.granteeSupervisorId;a.state.granteeMap[c]||(a.state.grantees.push(b.granteeSupervisor),a.state.granteeMap[c]=b.granteeSupervisor),a.state.granteeMap[c].granted=!0,a.state.granteeMap[c].grantStart=null!=b.startDate?moment(b.startDate).format("MM/DD/YYYY"):null,a.state.granteeMap[c].grantEnd=null!=b.endDate?moment(b.endDate).format("MM/DD/YYYY"):null})}).$promise}).then(function(b){return f.get({supId:a.state.empId},function(b){b.success&&(a.state.granters=b.overrides.map(function(a){var b=a.overrideSupervisor;return b.grantStartStr=a.startDate?moment(a.startDate).format("MM/DD/YYYY"):"No Start Date",b.grantEndStr=a.endDate?moment(a.endDate).format("MM/DD/YYYY"):"No End Date",b.activeStr=a.active?"Active":"Inactive",b})),a.state.fetched=!0}).$promise})["catch"](function(a){g.open("500",{details:a})})},a.saveGrants=function(){if(a.state.modified===!0&&a.state.fetched===!0){var b=a.state.grantees.filter(function(a){return a.modified===!0}).map(function(b){return a.createGrantSaveView(b)});a.state.saving=!0,e.save(b,function(b){a.state.saving=!1,a.state.modified=!1,a.state.saved=!0},function(a){g.open("500",{details:a})})}},a.createGrantSaveView=function(b){return{granteeSupervisorId:b.employeeId,active:b.granted,granterSupervisorId:a.state.empId,startDate:b.grantStart?moment(b.grantStart).format("YYYY-MM-DD"):null,endDate:b.grantEnd?moment(b.grantEnd).format("YYYY-MM-DD"):null}},a.setStartDate=function(b){a.state.modified=!0,b.modified=!0,b.grantStart?b.grantStart=null:b.grantStart=moment().format("MM/DD/YYYY")},a.setEndDate=function(b){a.state.modified=!0,b.modified=!0,b.grantEnd?b.grantEnd=null:b.grantEnd=moment().format("MM/DD/YYYY")},a.toggleGrantStatus=function(b){a.state.modified=!0,b.modified=!0},a.reset=function(){a.init()},a.init()}]);var essTime=angular.module("essTime");essTime.controller("PayPeriodCalendarCtrl",["$scope","$http","PayPeriodApi","HolidayApi","modals",function(a,b,c,d,e){a.state={year:moment().year(),currentDayMoment:moment().startOf("day")},a.yearList=Array.apply(0,Array(10)).map(function(b,c){return a.state.year+2-c-1}),a.months=[],a.periods=[],a.getPayPeriods=function(b,d){a.periodResp=c.get({periodType:"AF",year:b},function(){a.periods=a.periodResp.periods,a.periodMap=a.periods.reduce(function(a,b){return a[b.endDate]=b,a},{}),d&&d()},function(a){e.open("500",{details:a})})},a.getHolidays=function(b,c){a.holidaysResp=d.get({year:b},function(){a.holidays=a.holidaysResp.holidays,a.holidayMap=a.holidays.reduce(function(a,b){return a[b.date]=b,a},{}),c&&c()})},a.generateMonths=function(b){a.months=[];for(var c=0;12>c;c++)a.months.push(moment().year(b).month(c).format("M/D/YYYY"))},a.$watch("state.year",function(b,c){a.getPayPeriods(b,function(){a.getHolidays(b,function(){a.generateMonths(b)})})}),a.periodHighlight=function(){return function(b){var c=[],d=[],e=moment(b).startOf("day"),f=e.format("YYYY-MM-DD");return e.isSame(a.state.currentDayMoment)&&c.push("current-date"),6==e.day()||0==e.day()?c.push("weekend-date"):(a.holidayMap[f]&&(d.push(a.holidayMap[f].name),c.push("holiday-date")),a.periodMap[f]&&!a.periodMap[f].endYearSplit&&(d.push("Last Day of Pay Period "+a.periodMap[f].payPeriodNum),c.push("pay-period-end-date"))),[!1,c.join(" "),d.join(" \\ ")]}}}]);var essTime=angular.module("essTime");essTime.directive("timeRecordInput",[function(){return{restrict:"A",link:function(a,b,c){b.on("focus",function(a){$(this).attr("type","number"),$(this).parent().parent().addClass("active")}),b.on("blur",function(a){$(this).attr("type","text"),$(this).parent().parent().removeClass("active")})}}}]),essTime.directive("recordDetails",["appProps","modals",function(a,b){return{scope:{record:"="},templateUrl:a.ctxPath+"/template/time/record/details",link:function(a,c,d){a.close=b.reject,a.tempEntries=a.annualEntries=!1;var e=!1;a.$watch("record",function(){e||(angular.forEach(a.record.timeEntries,function(b){a.tempEntries=a.tempEntries||"TE"===b.payType,a.annualEntries=a.annualEntries||["RA","SA"].indexOf(b.payType)>-1}),e=!0)})}}}]),essTime.directive("recordDetailModal",["modals",function(a){return{template:'<div class="record-detail-modal" record-details record="record"></div>',link:function(b,c,d){var e=a.params();b.record=e.record}}}]);var essTime=angular.module("essTime");essTime.controller("EmpRecordHistoryCtrl",["$scope","$q","appProps","ActiveYearsTimeRecordsApi","TimeRecordApi","AttendanceRecordApi","SupervisorEmployeesApi","modals","RecordUtils",empRecordHistoryCtrl]);var essApp=angular.module("ess").controller("RecordEntryController",["$scope","$rootScope","$filter","$q","$timeout","appProps","ActiveTimeRecordsApi","TimeRecordApi","AccrualPeriodApi","AllowanceApi","MiscLeaveGrantApi","HolidayApi","activeTimeEntryRow","RecordUtils","LocationService","modals","promiseUtils",recordEntryCtrl]),essTime=angular.module("essTime");essTime.filter("timeRecordStatus",["$sce",function(a){var b={NOT_SUBMITTED:["Not Submitted","#444444"],SUBMITTED:["Submitted","#0e4e5a"],DISAPPROVED:["Supervisor Disapproved","#B90504"],APPROVED:["Supervisor Approved","#799933"],DISAPPROVED_PERSONNEL:["Personnel Disapproved","#B90504"],SUBMITTED_PERSONNEL:["Submitted Personnel","#808d0a"],APPROVED_PERSONNEL:["Personnel Approved","#799933"]};return function(c,d){var e=b.hasOwnProperty(c)?b[c][0]:"Unknown Status",f=b.hasOwnProperty(c)?b[c][1]:"red";return d?a.trustAsHtml("<span style='color:"+f+"'>"+e+"</span>"):e}}]),essTime.filter("miscLeave",["appProps",function(a){var b={};return angular.forEach(a.miscLeaves,function(a){b[a.type]=a}),function(a,c){return b.hasOwnProperty(a)?b[a].shortName:a?a+"?!":c?c:"--"}}]),essTime.filter("hoursDiffHighlighter",["$sce",function(a){return function(b){var c="#0e4e5a",d="";return b>0?(c="#09BB05",d="+"):0>b&&(c="#BB0505"),a.trustAsHtml('<span style="color:'+c+'">'+d+b+"</span>")}}]);var essTime=angular.module("essTime");essTime.controller("RecordHistoryCtrl",["$scope","$q","appProps","ActiveYearsTimeRecordsApi","TimeRecordApi","AttendanceRecordApi","modals","RecordUtils",recordHistoryCtrl]);var essApp=angular.module("ess");essApp.controller("RecordManageCtrl",["$scope","$q","appProps","RecordUtils","modals","badgeService","SupervisorTimeRecordsApi","TimeRecordApi","TimeRecordReminderApi",recordManageCtrl]);var essApp=angular.module("ess");essApp.directive("recordReviewModal",["appProps","modals","LocationService",recordReviewModal]),essApp.directive("recordReviewRejectModal",["modals","appProps",recordReviewRejectModal]),essApp.directive("recordApproveSubmitModal",["modals","appProps",recordApproveSubmitModal]),essApp.directive("recordReminderPromptModal",["modals","appProps",recordReminderPromptModal]);var essTime=angular.module("essTime");essTime.service("RecordUtils",[function(){function a(){return h.slice()}function b(a){return h.map(function(b){return+a[b]}).reduce(function(a,b){return a+b})}function c(a){for(var c=0,d=a.timeEntries;c<d.length;c++)d[c].total=b(d[c])}function d(a,b,c){var d=0,e=a.timeEntries;if(e)for(var f=0;f<e.length;f++)(!c||c.indexOf(e[f].payType)>=0)&&(d+=+(e[f][b]||0));return d}function e(a){var b={};for(var c in h){var e=h[c];b[e]=d(a,e)}return b.raSaWorkHours=d(a,"workHours",["RA","SA"]),b.tempWorkHours=d(a,"workHours",["TE"]),b.raSaTotal=d(a,"total",["RA","SA"]),b.total=d(a,"total"),b}function f(a){return a.totals={workHours:a.workHours,holidayHours:a.holidayHours,vacationHours:a.vacationHours,personalHours:a.personalHours,sickEmpHours:a.sickEmpHours,sickFamHours:a.sickFamHours,miscHours:a.miscHours,total:a.totalHours},a.recordStatus="APPROVED_PERSONNEL",a.payPeriod={payPeriodNum:a.payPeriodNum},a}function g(a,b){var c=moment(a.beginDate),d=moment(b.beginDate);if(c.isBefore(d))return-1;if(c.isAfter(d))return 1;var e=moment(a.endDate),f=moment(b.endDate);return e.isBefore(f)?-1:e.isAfter(f)?1:0}var h=["workHours","travelHours","holidayHours","vacationHours","personalHours","sickEmpHours","sickFamHours","miscHours"];return{getDailyTotal:b,calculateDailyTotals:c,getTotal:d,getRecordTotals:e,getTimeEntryFields:a,formatAttendRecord:f,compareRecords:g}}]);var essTime=angular.module("essTime"),binding=0;essTime.directive("recordValidator",["$timeout","$rootScope","activeTimeEntryRow",function(a,b,c){return{restrict:"A",scope:{validateRecord:"&validate",record:"="},link:function(d,e,f){d.$watch("record.timeRecordId",function(){a(function(){var f=!1;e.children().each(function(g){function h(a){c.setActiveRow(g),j()}function i(a){c.setActiveRow(null),j()}function j(){f=!0,a(function(){f&&(d.validateRecord(),b.$emit("validateRecordEntries"),f=!1)})}var k=angular.element(e.children()[g]);k.on("focusin",h),k.on("focusout",i)})})})}}}]),essTime.directive("entryValidator",["$timeout","$rootScope",function(a,b){return{restrict:"A",scope:{validate:"&"},link:function(a,c,d){function e(d,e){a.validate()?c.removeClass("invalid"):c.addClass("invalid"),b.$digest()}var f=b.$on("validateRecordEntries",e);a.$on("$destroy",f)}}}]),essTime.service("activeTimeEntryRow",function(){var a=null;return{getActiveRow:function(){return a},setActiveRow:function(b){a=b}}});var essApp=angular.module("ess");essApp.directive("supervisorRecordList",["appProps","modals",function(a,b){function c(a,c,d){a.showDetails=function(a){var c={record:a,employee:a.employee};b.open("record-details",c,!0)},a.toggleSelected=function(b){return a.selectedIndices?a.setSelected(b,!a.selectedIndices[b]):!1},a.setSelected=function(b,c){return a.selectedIndices?c?(a.selectedIndices[b]=!0,!0):(delete a.selectedIndices[b],!1):!1},a.toggleRecsForEmp=function(b){var c=null;a.selectedIndices&&angular.forEach(a.records,function(d,e){d.employeeId===b.employeeId&&(null===c?c=a.toggleSelected(e):a.setSelected(e,c))})}}return{scope:{supId:"=",records:"=",selectedIndices:"=?"},templateUrl:a.ctxPath+"/template/time/record/supervisor-record-list",link:c}}]);var essTime=angular.module("essTime");essApp.controller("TimeMainCtrl",["$scope","appProps","LocationService","badgeService","SupervisorTimeRecordCountsApi",function(a,b,c,d,e){a.initializePendingRecordsBadge=function(){var a="YYYY-MM-DD",c={supId:b.user.employeeId,status:"SUBMITTED",from:moment().subtract(1,"year").format(a),to:moment().format(a)};e.get(c,function(a){d.setBadgeValue("pendingRecordCount",a.result.count)})},a.go=function(a,b){c.go(a,!1,b)},a.logout=function(){c.go("/logout",!0)}}]);var essTimeOff=angular.module("essTime");essTimeOff.controller("NewRequestCtrl",["$scope","$http",function(a,b){a.vac=21,a.sick=482,a.personal=34}]),essSupply=angular.module("essSupply").controller("SupplyHistoryController",["$scope","SupplyEmployeesApi","SupplyRequisitionApi","LocationService","LocationApi","PaginationModel",supplyHistoryController]);var essSupply=angular.module("essSupply").controller("SupplyOrderHistoryCtrl",["$scope","appProps","LocationService","EmpInfoApi","SupplyRequisitionOrderHistoryApi","PaginationModel",supplyOrderHistoryCtrl]);angular.module("essSupply").service("SupplyItemAutocompleteService",["SupplyItemsApi",itemAutocompleteService]),angular.module("essSupply").service("SupplyLocationAutocompleteService",["appProps","LocationApi","SupplyDestinationApi",locationAutocompleteService]);var essSupply=angular.module("essSupply").directive("fulfillmentEditingModal",["appProps",function(a){return{templateUrl:a.ctxPath+"/template/supply/manage/fulfillment/modal/fulfillment-editing-modal",scope:{supplyEmployees:"=",locationStatistics:"="},controller:"FulfillmentEditingModal",controllerAs:"ctrl"}}]).directive("editableOrderListing",["appProps",function(a){return{restrict:"A",scope:!1,templateUrl:a.ctxPath+"/template/supply/manage/fulfillment/modal/editable-order-listing"}}]).controller("FulfillmentEditingModal",["$scope","appProps","modals","SupplyRequisitionByIdApi","SupplyLocationAutocompleteService","SupplyItemAutocompleteService",fulfillmentEditingModal]),essSupply=angular.module("essSupply");essSupply.directive("fulfillmentImmutableModal",["appProps","modals","LocationService",function(a,b,c){function d(a,c,d){a.requisition=b.params(),a.close=function(){b.resolve()}}return{templateUrl:a.ctxPath+"/template/supply/manage/fulfillment/modal/fulfillment-immutable-modal",link:d}}]),essSupply=angular.module("essSupply").controller("SupplyFulfillmentController",["$scope","SupplyRequisitionApi","SupplyEmployeesApi","SupplyItemsApi","modals","$interval","LocationService","SupplyLocationStatisticsService",supplyFulfillmentController]),essSupply=angular.module("essSupply").controller("SupplyReconciliationController",["$scope","SupplyReconciliationApi","SupplyRequisitionApi","LocationService","$window","$timeout",supplyReconciliationController]);var essSupply=angular.module("essSupply").controller("SupplyNavigationController",["$scope","$location","appProps","LocationService","SupplyCategoryService","SupplyOrderDestinationService",supplyNavigationController]);essSupply=angular.module("essSupply").controller("SupplyCartController",["$scope","SupplyCookieService","SupplyCartService","SupplyLocationAllowanceService","SupplyRequisitionApi","SupplyOrderDestinationService","appProps","modals","LocationService",supplyCartController]);var essSupply=angular.module("essSupply");essSupply.directive("cartSummary",["appProps",function(a){return{restrict:"E",controller:function(a,b){a.getTotalItems=function(){return b.getTotalItems()}},templateUrl:a.ctxPath+"/template/supply/order/cart/cart-summary",transclude:!0}}]),essSupply.directive("cartCheckoutModal",["appProps",function(a){return{restrict:"E",templateUrl:a.ctxPath+"/template/supply/order/cart/cart-checkout-modal",controller:"CartCheckoutModalCtrl",controllerAs:"ctrl"}}]).controller("CartCheckoutModalCtrl",["$scope","modals",function(a,b){a.requisitionId=b.params().result.requisitionId}]);var essSupply=angular.module("essSupply");essSupply.service("SupplyCartService",["SupplyLocationAllowanceService","SupplyCookieService",function(a,b){function c(a,b){this.item=a,this.quantity=b}function d(a,b){return b?b.quantity+a:a}var e=b.getCart();return{isOverOrderAllowance:function(a,b){return d(b,this.getCartLineItem(a.id))>a.maxQtyPerOrder?!0:!1},addToCart:function(a,d){return this.isItemInCart(a.id)?this.getCartLineItem(a.id).quantity+=d:e.push(new c(a,d)),b.addCart(e),!0},getCart:function(){return e},isItemInCart:function(a){var b=$.grep(e,function(b){return b.item.id===a});return b.length>0},getCartLineItem:function(a){var b=$.grep(e,function(b){return b.item.id===a});return b.length>0?b[0]:null},getTotalItems:function(){var a=0;return angular.forEach(e,function(b){a+=b.quantity}),a},removeFromCart:function(a){$.grep(e,function(b,c){b&&b.item.id===a&&e.splice(c,1)}),b.addCart(e)},reset:function(){e=[],b.addCart(e)}}}]),angular.module("essSupply").service("SupplyLocationAllowanceService",["SupplyLocationAllowanceApi",locationAllowanceService]),angular.module("essSupply").directive("orderCustomQuantityModal",["appProps",function(a){return{templateUrl:a.ctxPath+"/template/supply/order/order-custom-quantity-modal",controller:"OrderCustomQuantityModalCtrl",controllerAs:"ctrl"}}]).controller("OrderCustomQuantityModalCtrl",["$scope","modals","SupplyCartService",function(a,b,c){function d(){e=b.params();var d=c.getCartLineItem(e.item.id);a.quantity=d?d.quantity:1}var e={};a.quantity=1,d(),a.addToCart=function(){isNaN(a.quantity)||(c.isItemInCart(e.item.id)&&c.removeFromCart(e.item.id),c.addToCart(e.item,a.quantity),b.resolve())},a.cancel=function(){b.resolve()}}]),essSupply.service("SupplyOrderDestinationService",["appProps","SupplyCookieService","EmpInfoApi","SupplyLocationAutocompleteService",orderDestinationService]),angular.module("essSupply").directive("orderMorePromptModal",["appProps",function(a){return{templateUrl:a.ctxPath+"/template/supply/order/order-more-prompt-modal",controller:"OrderMorePromptModalCtrl",controllerAs:"ctrl"}}]).controller("OrderMorePromptModalCtrl",["$scope","modals",function(a,b){a.confirm=function(){b.resolve(b.params().allowance)},a.nevermind=function(){b.reject()}}]),angular.module("essSupply").directive("specialOrderItemModal",["appProps",function(a){return{templateUrl:a.ctxPath+"/template/supply/order/special-order-item-modal",controller:"SpecialOrderItemCtrl",controllerAs:"ctrl"}}]).controller("SpecialOrderItemCtrl",["$scope","modals","SupplyCartService",function(a,b,c){var d=b.params().allowance;a.cancel=function(){b.resolve()},a.addToCart=function(){c.addToCart(d.item,d.selectedQuantity),b.resolve()}}]);var essSupply=angular.module("essSupply").controller("SupplyOrderController",["$scope","appProps","LocationService","SupplyCartService","PaginationModel","SupplyLocationAutocompleteService","SupplyLocationAllowanceService","SupplyOrderDestinationService","modals","SupplyUtils",supplyOrderController]);essSupply.directive("destinationValidator",["SupplyLocationAutocompleteService",function(a){return{require:"ngModel",link:function(b,c,d,e){e.$validators.destination=function(b,c){return a.isValidCode(b)||0===b.length}}}}]),essSupply.directive("wholeNumberValidator",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.wholeNumber=function(a,b){return a%1===0&&null!==a}}}}]),essSupply=angular.module("essSupply").controller("SupplyViewController",["$scope","SupplyRequisitionHistoryApi","LocationService","$window","$timeout","SupplyUtils",supplyViewController]);var essSupply=angular.module("essSupply");essSupply.service("SupplyCategoryService",["SupplyLocationAllowanceService","SupplyOrderDestinationService",function(a,b){function c(a){this.name=a,this.selected=!1}function d(a){var b=$.grep(e,function(b){return b.name===a});return!b.length>0}var e=[],f=function(){var b=a.getAllowances();null!==b&&(angular.forEach(b,function(a){d(a.item.category.name)&&e.push(new c(a.item.category.name))}),e.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}))};return{getCategories:function(){return(null===e||0===e.length)&&f(),e},getSelectedCategoryNames:function(){var a=[];return angular.forEach(e,function(b){b.selected===!0&&a.push(b.name)}),a}}}]);var essSupply=angular.module("essSupply");essSupply.service("SupplyCookieService",["$cookies","appProps",supplyCookieService]);var essSupply=angular.module("essSupply");essSupply.service("SupplyInventoryService",["SupplyItemsApi",function(a){var b=[],c=!1;return a.get(function(a){b=a.result,c=!0}),{promise:c,getCopyOfItems:function(){return angular.copy(b)},orderQuantityRange:function(a){for(var b=[],c=1;c<=2*a.suggestedMaxQty;c++)b.push(c);return b},getCartLineItem:function(a){var c=!1,d=$.grep(b,function(b){return b.id===a});return d.length>0&&(c=d[0]),c}}}]);var essSupply=angular.module("essSupply");essSupply.service("SupplyLocationStatisticsService",["$q","SupplyLocationStatisticsApi",supplyLocationStatisticsService]),essSupply=angular.module("essSupply"),essSupply.service("SupplyUtils",[function(){return{alphabetizeLineItems:function(a){return a.sort(function(a,b){return a.item.description<b.item.description?-1:a.item.description>b.item.description?1:0}),a},alphabetizeAllowances:function(a){var b=angular.copy(a);return b.sort(function(a,b){return a.item.description<b.item.description?-1:a.item.description>b.item.description?1:0}),b}}}]),essSupply.directive("capitalize",function(a){return{require:"ngModel",link:function(b,c,d,e){var f=function(a){void 0===a&&(a="");var b=a.toUpperCase();return b!==a&&(e.$setViewValue(b),e.$render()),b};e.$parsers.push(f),f(a(d.ngModel)(b))}}}),essHelp=angular.module("essHelp"),essHelp.controller("HelpMainCtrl",["$scope","appProps",function(a,b){}]);